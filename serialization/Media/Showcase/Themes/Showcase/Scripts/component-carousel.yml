---
ID: "ea53e433-4a08-4fa8-b4bb-b3ab598f5672"
Parent: "f96e1925-a3cc-4752-b969-70feb5b5d696"
Template: "962b53c4-f93b-4df9-9821-415c867b8903"
Path: "/sitecore/media library/Project/Showcase/Themes/Showcase/Scripts/component-carousel"
DB: master
SharedFields:
- ID: "06d5295c-ed2f-4a54-9bf2-26228d113318"
  Hint: __Icon
  Value: "-/media/EA53E4334A084FA8B4BBB3AB598F5672.ashx?h=16&thn=1&w=16"
- ID: "40e50ed9-ba07-4702-992e-a912738d32dc"
  Hint: Blob
  BlobID: "6af4e823-eb7f-4239-bc66-43e0e90c4f5d"
  Value: LyoqDQogKiBDb2duaWZpZGUNCiAqDQogKiBYQS5jb21wb25lbnQuY2Fyb3VzZWxzIG1vZHVsZS4NCiAqDQogKiBFeHBvc2VzIHJlZ2lzdGVyKHNlbGVjdG9yLCBvcHRpb25zKSBtZXRob2QsIHdoaWNoIGluaXRpYWxpemVzIENhcm91c2VsDQogKiBmb3IgZWFjaCBlbGVtZW50cyB0aGF0IG1hdGNoIHRoZSBwcm92aWRlZCBzZWxlY3Rvciwgd2l0aCBnaXZlbiBvcHRpb25zLg0KICogRWxlbWVudCB1c2VkIGFzIGEgY2Fyb3VzZWwgbXVzdCBjb250YWluIGEgPHVsIGNsYXNzPSJzbGlkZXMiPiB0YWcuDQogKiBUaGF0IHRhZyBoYXZlIHRvIGJlIGZpbGxlZCB3aXRoIDxsaT4gZWxlbWVudHMuIEVhY2ggPGxpPiBlbGVtZW50IHdpbGwgYmUgY29uc2lkZXJlZCBhcyBhIHNsaWRlLg0KICogRm9yIG1vcmUgZGV0YWlscyByZWFkIHRoZSBkb2N1bWVudGF0aW9uIG9mIGEgcmVnaXN0ZXIoc2VsZWN0b3IsIG9wdGlvbnMpIG1ldGhvZC4NCiAqDQogKiBAcmVxdWlyZXMgalF1ZXJ5IEphdmFTY3JpcHQgTGlicmFyeSB2MS40LjQgb3IgaGlnaGVyDQogKi8NClhBLmNvbXBvbmVudC5jYXJvdXNlbHMgPSAoZnVuY3Rpb24oJCkgew0KICAgIHZhciBwdWIgPSB7fSwNCiAgICAgICAgTmF2aWdhdGlvbkJ1aWxkZXIgPSBudWxsLA0KICAgICAgICBTbGlkZXJJbml0aWFsaXplciA9IG51bGw7DQoNCiAgICAvKioNCiAgICAgKiBUaW1lciBjbGFzcyBzYXZlcyB0aW1lIHN0YW1wIGFuZCBjb3VudHMgdGltZSBkaWZmZXJlbmNlIGJldHdlZW4NCiAgICAgKiBjdXJyZW50IHRpbWUgKHVwZGF0ZSgpIG1ldGhvZCkgYW5kIHNhdmVkIHRpbWUgc3RhbXAuDQogICAgICogQGNvbnN0cnVjdG9yDQogICAgICovDQogICAgZnVuY3Rpb24gVGltZXIoKSB7DQogICAgICAgIC8qKg0KICAgICAgICAgKiBUaW1lIGRpZmZlcmVuY2UgYmV0d2VlbiBsYXN0IHVwZGF0ZSgpIGNhbGwgYW5kIGxhc3Qgc2V0KCkgY2FsbA0KICAgICAgICAgKg0KICAgICAgICAgKiBAbWVtYmVyIFRpbWVyDQogICAgICAgICAqLw0KICAgICAgICB0aGlzLmVsYXBzZWQgPSAwOw0KICAgICAgICAvKioNCiAgICAgICAgICogVGltZSBzdGFtcA0KICAgICAgICAgKg0KICAgICAgICAgKiBAbWVtYmVyIFRpbWVyDQogICAgICAgICAqLw0KICAgICAgICB0aGlzLnN0YW1wID0gbnVsbDsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiAgQ291bnRzIHRpbWUgZGlmZmVyZW5jZSBiZXR3ZWVuIGN1cnJlbnQgdGltZSBhbmQgc2F2ZWQgdGltZSBzdGFtcA0KICAgICAqDQogICAgICogQG1lbWJlciBUaW1lcg0KICAgICAqLw0KICAgIFRpbWVyLnByb3RvdHlwZS51cGRhdGUgPSBmdW5jdGlvbigpIHsNCiAgICAgICAgaWYgKHRoaXMuc3RhbXAgIT09IG51bGwpIHsNCiAgICAgICAgICAgIHRoaXMuZWxhcHNlZCArPSB0aGlzLm5ld1N0YW1wKCkgLSB0aGlzLnN0YW1wOw0KICAgICAgICB9DQogICAgfTsNCg0KICAgIC8qKg0KICAgICAqICBTYXZlcyBuZXcgdGltZSBzdGFtcA0KICAgICAqDQogICAgICogQG1lbWJlciBUaW1lcg0KICAgICAqLw0KICAgIFRpbWVyLnByb3RvdHlwZS5zZXQgPSBmdW5jdGlvbigpIHsNCiAgICAgICAgdGhpcy5zdGFtcCA9IHRoaXMubmV3U3RhbXAoKTsNCiAgICB9Ow0KDQogICAgLyoqDQogICAgICogIENvdW50cyB0aW1lIGRpZmZlcmVuY2UgYmV0d2VlbiBjdXJyZW50IHRpbWUgYW5kIHNhdmVkIHRpbWUgc3RhbXANCiAgICAgKg0KICAgICAqIEBtZW1iZXIgVGltZXINCiAgICAgKiBAcmV0dXJuIHN0YW1wIG9mIGEgY3VycmVudCB0aW1lDQogICAgICogQHR5cGUgTnVtYmVyDQogICAgICovDQogICAgVGltZXIucHJvdG90eXBlLm5ld1N0YW1wID0gZnVuY3Rpb24oKSB7DQogICAgICAgIHJldHVybiBuZXcgRGF0ZSgpLnZhbHVlT2YoKTsNCiAgICB9Ow0KDQogICAgLyoqDQogICAgICogIFJlc2V0cyBlbGFwc2VkIHRpbWUuDQogICAgICoNCiAgICAgKiBAbWVtYmVyIFRpbWVyDQogICAgICovDQogICAgVGltZXIucHJvdG90eXBlLnJlc2V0ID0gZnVuY3Rpb24oKSB7DQogICAgICAgIHRoaXMuZWxhcHNlZCA9IDA7DQogICAgfTsNCiAgICAvKioNCiAgICAgKiBFbmQgb2YgVGltZXIgY2xhc3MNCiAgICAgKi8NCg0KICAgIC8qKg0KICAgICAqIFRpbWVJbmRpY2F0b3IgY2xhc3MgZXh0ZW5kcyBUaW1lciBjbGFzcw0KICAgICAqIEBjb25zdHJ1Y3Rvcg0KICAgICAqIEBwYXJhbSB7T2JqZWN0fSAkICAgICBhIGpRdWVyeSBvYmplY3QNCiAgICAgKiBAcGFyYW0ge1hBLmNvbXBvbmVudC5jYXJvdXNlbHMuSW5kaWNhdG9yVmlld3MuVmlld30gdmlldyAgYSB0aW1lIGluZGljYXRvciB2aWV3Lg0KICAgICAqIEBwYXJhbSB7TnVtYmVyfSB0aW1lb3V0ICAgYSB2aWV3IHRpbWVvdXQNCiAgICAgKiBAYmFzZSBUaW1lcg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIFRpbWVJbmRpY2F0b3IoJCwgdmlldywgdGltZW91dCkgew0KICAgICAgICAvKioNCiAgICAgICAgICogQSB0aW1lIGluZGljYXRvciB2aWV3Lg0KICAgICAgICAgKg0KICAgICAgICAgKiBAbWVtYmVyIFRpbWVySW5kaWNhdG9yDQogICAgICAgICAqLw0KICAgICAgICB0aGlzLnZpZXcgPSB2aWV3Ow0KDQogICAgICAgIHRoaXMudmlldy5pbml0KHRpbWVvdXQpOw0KICAgIH0NCiAgICBUaW1lSW5kaWNhdG9yLnByb3RvdHlwZSA9IG5ldyBUaW1lcigpOw0KICAgIFRpbWVJbmRpY2F0b3IuY29uc3RydWN0b3IgPSBUaW1lcjsNCg0KICAgIC8qKg0KICAgICAqIFBsYXlzIHRoZSBhdHRhY2hlZCB2aWV3Lg0KICAgICAqDQogICAgICogQG1lbWJlciBUaW1lckluZGljYXRvcg0KICAgICAqLw0KICAgIFRpbWVJbmRpY2F0b3IucHJvdG90eXBlLnBsYXkgPSBmdW5jdGlvbigpIHsNCiAgICAgICAgdGhpcy52aWV3LnBsYXkoKTsNCiAgICB9Ow0KDQogICAgLyoqDQogICAgICogUGF1c2VzIHRoZSBhdHRhY2hlZCB2aWV3Lg0KICAgICAqDQogICAgICogQG1lbWJlciBUaW1lckluZGljYXRvcg0KICAgICAqLw0KICAgIFRpbWVJbmRpY2F0b3IucHJvdG90eXBlLnBhdXNlID0gZnVuY3Rpb24oKSB7DQogICAgICAgIHRoaXMudmlldy5wYXVzZSgpOw0KICAgIH07DQoNCiAgICAvKioNCiAgICAgKiBSZXNldHMgZWxhcHNlZCB0aW1lIGFuZCByZXNldHMgdGhlIGF0dGFjaGVkIHZpZXcuDQogICAgICoNCiAgICAgKiBAbWVtYmVyIFRpbWVySW5kaWNhdG9yDQogICAgICovDQogICAgVGltZUluZGljYXRvci5wcm90b3R5cGUucmVzZXQgPSBmdW5jdGlvbigpIHsNCiAgICAgICAgVGltZXIucHJvdG90eXBlLnJlc2V0LmNhbGwodGhpcyk7DQogICAgICAgIHRoaXMudmlldy5yZXNldCgpOw0KICAgIH07DQoNCiAgICAvKioNCiAgICAgKiBDb3VudHMgdGltZSBkaWZmZXJlbmNlIGJldHdlZW4gY3VycmVudCB0aW1lIGFuZCBzYXZlZCB0aW1lIHN0YW1wLg0KICAgICAqIGFuZCB1cGRhdGVzIHRoZSBhdHRhY2hlZCB2aWV3DQogICAgICoNCiAgICAgKiBAbWVtYmVyIFRpbWVySW5kaWNhdG9yDQogICAgICovDQogICAgVGltZUluZGljYXRvci5wcm90b3R5cGUudXBkYXRlID0gZnVuY3Rpb24oKSB7DQogICAgICAgIFRpbWVyLnByb3RvdHlwZS51cGRhdGUuY2FsbCh0aGlzKTsNCiAgICAgICAgdGhpcy52aWV3LnVwZGF0ZSh0aGlzLmVsYXBzZWQpOw0KICAgIH07DQogICAgLyoqDQogICAgICogZW5kIG9mIFRpbWVJbmRpY2F0b3IgY2xhc3MNCiAgICAgKi8NCg0KICAgIC8qKg0KICAgICAqIE5hdmlnYXRpb25CdWlsZGVyIG9iamVjdCBjcmVhdGVzIG5hdmlnYXRpb24gaXRlbXMNCiAgICAgKi8NCiAgICBOYXZpZ2F0aW9uQnVpbGRlciA9IChmdW5jdGlvbigkKSB7DQoNCiAgICAgICAgcmV0dXJuIHsNCiAgICAgICAgICAgIGNyZWF0ZUl0ZW0gOiBmdW5jdGlvbihzZXR0aW5ncykgew0KICAgICAgICAgICAgICAgIHZhciB0ZXh0ID0gc2V0dGluZ3MudGV4dCwNCiAgICAgICAgICAgICAgICAgICAgJG5hdkl0ZW0gPSBudWxsOw0KDQogICAgICAgICAgICAgICAgc2V0dGluZ3MudGV4dCA9ICcnOw0KICAgICAgICAgICAgICAgIHNldHRpbmdzLmhyZWYgPSAnIyc7DQoNCiAgICAgICAgICAgICAgICAkbmF2SXRlbSA9ICQoJzxhPicsIHNldHRpbmdzKTsNCiAgICAgICAgICAgICAgICAkKCc8c3Bhbj4nLCB7DQogICAgICAgICAgICAgICAgICAgICd0ZXh0JzogdGV4dA0KICAgICAgICAgICAgICAgIH0pLmFwcGVuZFRvKCRuYXZJdGVtKTsNCg0KICAgICAgICAgICAgICAgIHJldHVybiAkbmF2SXRlbTsNCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICAvKioNCiAgICAgICAgICAgICAqIFJldHVybnMgdGhlIGVsZW1lbnQocykgdGhhdCBtYXRjaChlcykgdGhlIHByb3ZpZGVkIHNlbGVjdG9yIG9yIG51bGwNCiAgICAgICAgICAgICAqDQogICAgICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gc2VsZWN0b3IgYSBzZWxlY3RvciB1c2VkIGZvciBzZWFyY2hpbmcNCiAgICAgICAgICAgICAqIEByZXR1cm4gYSBqUXVlcnkgb2JqZWN0IGNvbnRhaW5pbmcgZWxlbWVudChzKSB0aGF0IG1hdGNoKGVzKSB0aGUgcHJvdmlkZWQgc2VsZWN0b3Igb3IgbnVsbCBpZiBubyBlbGVtZW50IG1hdGNoDQogICAgICAgICAgICAgKiBAdHlwZSBPYmplY3QNCiAgICAgICAgICAgICAqLw0KICAgICAgICAgICAgZ2V0RWxlbWVudDogZnVuY3Rpb24oc2VsZWN0b3IsIHdyYXBwZXIpIHsNCiAgICAgICAgICAgICAgICB2YXIgJGVsZW1lbnQgPSAkKHdyYXBwZXIpLmZpbmQoIi5uYXYtaXRlbXMiKTsNCg0KICAgICAgICAgICAgICAgIGlmICgkZWxlbWVudC5sZW5ndGggPT09IDApIHsNCiAgICAgICAgICAgICAgICAgICAgJGVsZW1lbnQgPSBudWxsOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIHJldHVybiAkZWxlbWVudDsNCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICAvKioNCiAgICAgICAgICAgICAqIENyZWF0ZXMgbmF2aWdhdGlvbiBpdGVtcyBhbmQgYXBwZW5kcyB0aGVtIHRvICRjb250YWluZXIuDQogICAgICAgICAgICAgKg0KICAgICAgICAgICAgICogQHBhcmFtIHtPYmplY3R9ICRjb250YWluZXIgICBuYXZpZ2F0aW9uIGl0ZW1zIGNvbnRhaW5lciAoalF1ZXJ5IG9iamVjdCkNCiAgICAgICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBsYWJlbCAgIG5hdmlnYXRpb24gaXRlbXMgbGFiZWwgdGVtcGxhdGUNCiAgICAgICAgICAgICAqIEBwYXJhbSB7TnVtYmVyfSBjb3VudCAgICBudW1iZXIgb2YgbmF2aWdhdGlvbiBpdGVtcyB0byBjcmVhdGUNCiAgICAgICAgICAgICAqLw0KICAgICAgICAgICAgY3JlYXRlSXRlbXM6IGZ1bmN0aW9uKCRjb250YWluZXIsIGxhYmVsLCBjb3VudCkgew0KICAgICAgICAgICAgICAgIHZhciBpLA0KICAgICAgICAgICAgICAgICAgICBwYXR0ZXJuID0gLyNce2luZGV4XH0vZywNCiAgICAgICAgICAgICAgICAgICAgc2V0dGluZ3M7DQoNCiAgICAgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgY291bnQ7IGkrKykgew0KICAgICAgICAgICAgICAgICAgICBzZXR0aW5ncyA9IHsNCiAgICAgICAgICAgICAgICAgICAgICAgICd0ZXh0JzogbGFiZWwucmVwbGFjZShwYXR0ZXJuLCBpICsgMSkNCiAgICAgICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICAgICAgc2V0dGluZ3MudGV4dCA9ICcnOw0KICAgICAgICAgICAgICAgICAgICBzZXR0aW5ncy5ocmVmID0gJyMnOw0KDQoNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5jcmVhdGVJdGVtKHNldHRpbmdzKS5hcHBlbmRUbygkY29udGFpbmVyKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgLyoqDQogICAgICAgICAgICAgKiBDcmVhdGVzIG9yIHNlbGVjdHMgJ3ByZXZpb3VzJy8nbmV4dCcgbmF2aWdhdGlvbiBpdGVtLg0KICAgICAgICAgICAgICogTW9kZSBvZiBhY3Rpb24gZGVwZW5kcyBvbiBzZXR0aW5ncyBvYmplY3Q6DQogICAgICAgICAgICAgKiB2YXIgc2V0dGluZ3MgPSB7DQogICAgICAgICAgICAgKiAgICAgaXNDb250YWluZXI6IEJvb2xlYW4gdmFsdWUsDQogICAgICAgICAgICAgKiAgICAgbGFiZWw6IFN0cmluZyB2YWx1ZSwNCiAgICAgICAgICAgICAqICAgICBzZWxlY3RvcjogU3RyaW5nIHZhbHVlLA0KICAgICAgICAgICAgICogICAgIG1ldGhvZDogU3RyaW5nIHZhbHVlDQogICAgICAgICAgICAgKiB9Ow0KICAgICAgICAgICAgICoNCiAgICAgICAgICAgICAqIElmIHNldHRpbmdzLnNlbGVjdG9yID09PSBudWxsIG9yIGlmIHNldHRpbmdzLnNlbGVjdG9yICE9PSBudWxsIGFuZCBzZXR0aW5ncy5pc0NvbnRhaW5lciA9PSB0cnVlDQogICAgICAgICAgICAgKiBuYXZpZ2F0aW9uIGl0ZW0gaXMgY3JlYXRlZCBhbmQgYXR0YWNoZWQgdG8gJGVsZW1lbnQuZmlyc3QoKSAodXNpbmcgc2V0dGluZ3MubWV0aG9kKS4NCiAgICAgICAgICAgICAqIElmIHNldHRpbmdzLnNlbGVjdG9yICE9PSBudWxsIGFuZCBzZXR0aW5ncy5pc0NvbnRhaW5lciA9PSBmYWxzZQ0KICAgICAgICAgICAgICogJGVsZW1lbnQuZmlyc3QoKSBpcyBzZWxlY3RlZCBhcyBuYXZpZ2F0aW9uIGl0ZW0NCiAgICAgICAgICAgICAqDQogICAgICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gc2V0dGluZ3Mgc2V0dGluZ3Mgb2YgbmF2aWdhdGlvbiBpdGVtDQogICAgICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gaXRlbVNldHRpbmdzICAgaHRtbCBhdHRyaWJ1dGVzIG9mIG5hdmlnYXRpb24gaXRlbQ0KICAgICAgICAgICAgICogQHBhcmFtIHtPYmplY3R9ICRlbGVtZW50ICAgIG5hdmlnYXRpb24gaXRlbXMgY29udGFpbmVyIChqUXVlcnkgb2JqZWN0KQ0KICAgICAgICAgICAgICogQHJldHVybiBUaGUgJ3ByZXYnLyduZXh0JyBuYXZpZ2F0aW9uIGl0ZW0NCiAgICAgICAgICAgICAqIEB0eXBlIE9iamVjdA0KICAgICAgICAgICAgICovDQogICAgICAgICAgICBjcmVhdGVQcmV2TmV4dEl0ZW06IGZ1bmN0aW9uKHNldHRpbmdzLCBpdGVtU2V0dGluZ3MsICRlbGVtZW50KSB7DQogICAgICAgICAgICAgICAgdmFyICRpdGVtID0gbnVsbCwNCiAgICAgICAgICAgICAgICAgICAgaXNTZWxlY3RvckV4aXN0cyA9IHNldHRpbmdzLnNlbGVjdG9yICE9PSBudWxsOw0KDQoNCiAgICAgICAgICAgICAgICBpZiAoaXNTZWxlY3RvckV4aXN0cykgew0KICAgICAgICAgICAgICAgICAgICAkZWxlbWVudCA9IHRoaXMuZ2V0RWxlbWVudChzZXR0aW5ncy5zZWxlY3Rvcik7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgaWYgKCRlbGVtZW50ICE9PSBudWxsKSB7DQogICAgICAgICAgICAgICAgICAgIGlmIChzZXR0aW5ncy5pc0NvbnRhaW5lciB8fCAhaXNTZWxlY3RvckV4aXN0cykgew0KICAgICAgICAgICAgICAgICAgICAgICAgJGl0ZW0gPSB0aGlzLmNyZWF0ZUl0ZW0oJC5leHRlbmQoe30sIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAndGV4dCc6IHNldHRpbmdzLmxhYmVsDQogICAgICAgICAgICAgICAgICAgICAgICB9LCBpdGVtU2V0dGluZ3MpKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICgkZWxlbWVudC5maXJzdCgpKVtzZXR0aW5ncy5tZXRob2RdKCRpdGVtKTsNCiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICRpdGVtID0gJGVsZW1lbnQuZmlyc3QoKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIHJldHVybiAkaXRlbTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfTsNCiAgICB9KCQpKTsNCiAgICAvKioNCiAgICAgKiBlbmQgb2YgTmF2aWdhdGlvbkJ1aWxkZXIgb2JqZWN0DQogICAgICovDQoNCiAgICAvKioNCiAgICAgKiBOYXZpZ2F0aW9uIGNsYXNzIGhvbGRzIG5hdmlnYXRpb24gaXRlbXMuDQogICAgICogQGNvbnN0cnVjdG9yDQogICAgICovDQogICAgZnVuY3Rpb24gTmF2aWdhdGlvbigkLCAkd3JhcHBlciwgb3B0aW9ucykgew0KICAgICAgICB2YXIgZGVmYXVsdHMgPSB7DQogICAgICAgICAgICAgICAgJ2lzRW5hYmxlZCc6IHRydWUsDQogICAgICAgICAgICAgICAgJ2hhc1ByZXZOZXh0SXRlbXMnOiB0cnVlLA0KICAgICAgICAgICAgICAgICdpdGVtJzogew0KICAgICAgICAgICAgICAgICAgICAnbGFiZWwnOiAnI3tpbmRleH0nLA0KICAgICAgICAgICAgICAgICAgICAnc2VsZWN0b3InOiBudWxsDQogICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICAncHJldkl0ZW0nOiB7DQogICAgICAgICAgICAgICAgICAgICdsYWJlbCc6ICc8JywNCiAgICAgICAgICAgICAgICAgICAgJ3NlbGVjdG9yJzogbnVsbCwNCiAgICAgICAgICAgICAgICAgICAgJ2lzQ29udGFpbmVyJzogZmFsc2UNCiAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgICduZXh0SXRlbSc6IHsNCiAgICAgICAgICAgICAgICAgICAgJ2xhYmVsJzogJz4nLA0KICAgICAgICAgICAgICAgICAgICAnc2VsZWN0b3InOiBudWxsLA0KICAgICAgICAgICAgICAgICAgICAnaXNDb250YWluZXInOiBmYWxzZQ0KICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgJ3NsaWRlc0NvdW50JzogMA0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIHNldHRpbmdzID0gJC5leHRlbmQodHJ1ZSwge30sIGRlZmF1bHRzLCBvcHRpb25zKSwNCiAgICAgICAgICAgICRjb250YWluZXI7DQoNCiAgICAgICAgLyoqDQogICAgICAgICAqIGpRdWVyeSBvYmplY3QNCiAgICAgICAgICoNCiAgICAgICAgICogQG1lbWJlciBOYXZpZ2F0aW9uDQogICAgICAgICAqLw0KICAgICAgICB0aGlzLiQgPSAkOw0KICAgICAgICAvKioNCiAgICAgICAgICogTmF2aWdhdGlvbiBpdGVtcyAob25lIGZvciBlYWNoIHNsaWRlIGlmIG5hdmlnYXRpb24gaXMgZW5hYmxlZCkuDQogICAgICAgICAqDQogICAgICAgICAqIEBtZW1iZXIgTmF2aWdhdGlvbg0KICAgICAgICAgKi8NCiAgICAgICAgdGhpcy4kaXRlbXMgPSAkKCk7DQogICAgICAgIC8qKg0KICAgICAgICAgKiBOYXZpZ2F0aW9uICduZXh0JyBpdGVtIChpZiBwcmV2L25leHQgaXRlbXMgYXJlIGVuYWJsZWQpLg0KICAgICAgICAgKg0KICAgICAgICAgKiBAbWVtYmVyIE5hdmlnYXRpb24NCiAgICAgICAgICovDQogICAgICAgIHRoaXMuJG5leHRJdGVtID0gJCgpOw0KICAgICAgICAvKioNCiAgICAgICAgICogTmF2aWdhdGlvbiAncHJldmlvdXMnIGl0ZW0gKGlmIHByZXYvbmV4dCBpdGVtcyBhcmUgZW5hYmxlZCkuDQogICAgICAgICAqDQogICAgICAgICAqIEBtZW1iZXIgTmF2aWdhdGlvbg0KICAgICAgICAgKi8NCiAgICAgICAgdGhpcy4kcHJldkl0ZW0gPSAkKCk7DQogICAgICAgIC8qKg0KICAgICAgICAgKiBTZWxlY3RlZCBpdGVtIChvbmUgZnJvbSB0aGlzLiRpdGVtcyBvciBudWxsKS4NCiAgICAgICAgICoNCiAgICAgICAgICogQG1lbWJlciBOYXZpZ2F0aW9uDQogICAgICAgICAqLw0KICAgICAgICB0aGlzLiRzZWxlY3RlZEl0ZW0gPSBudWxsOw0KDQogICAgICAgIC8vaW5pdGlhbGl6YXRpb24NCiAgICAgICAgaWYgKHNldHRpbmdzLmlzRW5hYmxlZCkgew0KICAgICAgICAgICAgJGNvbnRhaW5lciA9IHRoaXMucHJlcGFyZUl0ZW1zKHNldHRpbmdzLml0ZW0sIHNldHRpbmdzLnNsaWRlc0NvdW50LCAkd3JhcHBlcik7DQogICAgICAgICAgICBpZiAoc2V0dGluZ3MuaGFzUHJldk5leHRJdGVtcykgew0KICAgICAgICAgICAgICAgIHRoaXMucHJlcGFyZVByZXZOZXh0SXRlbXMoc2V0dGluZ3MsICRjb250YWluZXIpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAkd3JhcHBlci5maW5kKCcubmF2JykudHJpZ2dlcignbmF2aWdhdGlvbi1jcmVhdGVkJywgdGhpcyk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBDU1MgY2xhc3NtIHdoaWNoIHdpbGwgYmUgdXNlZCBmb3IgbWFyayBzZWxlY3RlZCBpdGVtDQogICAgICoNCiAgICAgKiBAbWVtYmVyIE5hdmlnYXRpb24NCiAgICAgKi8NCiAgICBOYXZpZ2F0aW9uLnByb3RvdHlwZS5zZWxlY3RlZEl0ZW1DbGFzcyA9ICdhY3RpdmUnOw0KDQogICAgLyoqDQogICAgICogTWFyayBuYXZpZ2F0aW9uIGl0ZW0gd2l0aCBnaXZlbiBpbmRleCBhcyBzZWxlY3RlZC4NCiAgICAgKg0KICAgICAqIEBtZW1iZXIgTmF2aWdhdGlvbg0KICAgICAqIEBwYXJhbSB7TnVtYmVyfSBpbmRleCAgICAgaW5kZXggb2YgbmF2aWdhdGlvbiBpdGVtDQogICAgICovDQogICAgTmF2aWdhdGlvbi5wcm90b3R5cGUuc2VsZWN0SXRlbSA9IGZ1bmN0aW9uKGluZGV4KSB7DQogICAgICAgIGlmICh0aGlzLiRzZWxlY3RlZEl0ZW0gIT09IG51bGwpIHsNCiAgICAgICAgICAgIHRoaXMuJHNlbGVjdGVkSXRlbS5yZW1vdmVDbGFzcyh0aGlzLnNlbGVjdGVkSXRlbUNsYXNzKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHRoaXMuJHNlbGVjdGVkSXRlbSA9IHRoaXMuJGl0ZW1zLmVxKGluZGV4KS5hZGRDbGFzcyh0aGlzLnNlbGVjdGVkSXRlbUNsYXNzKTsNCiAgICB9Ow0KDQogICAgLyoqDQogICAgICogQ3JlYXRlcyBvciBzZWxlY3RzIG5hdmlnYXRpb24gaXRlbXMgY29udGFpbmVyIGFuZCBmaWxscyBpdCB3aXRoIG5hdmlnYXRpb24gaXRlbXMuDQogICAgICogSWYgbmF2aWdhdGlvbiBpdGVtcyBjb250YWluZXIgaXMgbm90IGVtcHR5LCBjaGlsZCBlbGVtZW50cyBhcmUgYWRvcHRlZCBhcyBuYXZpZ2F0aW9uIGl0ZW1zLg0KICAgICAqIE1vZGUgb2YgYWN0aW9uIGRlcGVuZHMgb24gc2V0dGluZ3Mgb2JqZWN0Og0KICAgICAqIHZhciBzZXR0aW5ncyA9IHsNCiAgICAgKiAgICAgJ2xhYmVsJzogJyN7aW5kZXh9JywNCiAgICAgKiAgICAgJ3NlbGVjdG9yJzogbnVsbA0KICAgICAqIH07DQogICAgICogSWYgc2V0dGluZ3Muc2VsZWN0b3IgPT09IG51bGwgbmF2aWdhdGlvbiBpdGVtIGNvbnRhaW5lciBpcyBjcmVhdGVkLg0KICAgICAqIElmIHNldHRpbmdzLnNlbGVjdG9yICE9PSBudWxsIGVsZW1lbnQgdGhhdCBtYXRjaCBzZXR0aW5ncy5zZWxlY3RvciBpcyBhZGFwdGVkIGFzIG5hdmlnYWdhdGlvbiBpdGVtcyBjb250YWluZXIuDQogICAgICoNCiAgICAgKiBAbWVtYmVyIE5hdmlnYXRpb24NCiAgICAgKiBAcGFyYW0ge09iamVjdH0gc2V0dGluZ3Mgc2V0dGluZ3Mgb2YgbmF2aWdhdGlvbiBpdGVtcw0KICAgICAqIEBwYXJhbSB7TnVtYmVyfSBjb3VudCAgIG51bWJlciBvZiBuYXZpZ2F0aW9uIGl0ZW1zDQogICAgICogQHBhcmFtIHtPYmplY3R9ICR3cmFwcGVyICAgIHdyYXBwZXIgb2YgbmF2aWdhdGlvbiBpdGVtcyBjb250YWluZXIgKGpRdWVyeSBvYmplY3QpDQogICAgICogQHJldHVybiBUaGUgY29udGFpbmVyIGZpbGxlZCB3aXRoIG5hdmlnYXRpb24gaXRlbXMuDQogICAgICogQHR5cGUgT2JqZWN0DQogICAgICovDQogICAgTmF2aWdhdGlvbi5wcm90b3R5cGUucHJlcGFyZUl0ZW1zID0gZnVuY3Rpb24oc2V0dGluZ3MsIGNvdW50LCAkd3JhcHBlcikgew0KICAgICAgICB2YXIgJGNvbnRhaW5lciA9IG51bGw7DQoNCiAgICAgICAgaWYgKHNldHRpbmdzLnNlbGVjdG9yICE9PSBudWxsKSB7DQogICAgICAgICAgICAkY29udGFpbmVyID0gTmF2aWdhdGlvbkJ1aWxkZXIuZ2V0RWxlbWVudChzZXR0aW5ncy5zZWxlY3RvciwgJHdyYXBwZXIpOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgJGNvbnRhaW5lciA9ICQoJzxkaXYvPicsIHsNCiAgICAgICAgICAgICAgICAnY2xhc3MnOiAnbmF2Jw0KICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAkY29udGFpbmVyLmFwcGVuZFRvKCR3cmFwcGVyKTsNCiAgICAgICAgfQ0KDQogICAgICAgIGlmICgkY29udGFpbmVyICE9PSBudWxsKSB7DQogICAgICAgICAgICBpZiAoJGNvbnRhaW5lci5jaGlsZHJlbigpLmxlbmd0aCA9PT0gMCkgew0KICAgICAgICAgICAgICAgIE5hdmlnYXRpb25CdWlsZGVyLmNyZWF0ZUl0ZW1zKCRjb250YWluZXIsIHNldHRpbmdzLmxhYmVsLCBjb3VudCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICB0aGlzLiRpdGVtcyA9ICRjb250YWluZXIuY2hpbGRyZW4oKS5zbGljZSgwLCBjb3VudCk7DQogICAgICAgIH0NCg0KICAgICAgICByZXR1cm4gJGNvbnRhaW5lcjsNCiAgICB9Ow0KDQogICAgLyoqDQogICAgICogQ3JlYXRlcyBvciBzZWxlY3RzIG5hdmlnYXRpb24gJ3ByZXZpb3VzJyBhbmQgJ25leHQnIG5hdmlnYXRpb24gaXRlbXMgKEBzZWUgTmF2aWdhdGlvbkJ1aWxkZXIuY3JlYXRlUHJldk5leHRJdGVtKCkpLg0KICAgICAqIElmIG5hdmlnYXRpb24gaXRlbXMgY29udGFpbmVyIGlzIG5vdCBlbXB0eSwgY2hpbGQgZWxlbWVudHMgYXJlIGFkb3B0ZWQgYXMgbmF2aWdhdGlvbiBpdGVtcy4NCiAgICAgKg0KICAgICAqIEBtZW1iZXIgTmF2aWdhdGlvbg0KICAgICAqIEBwYXJhbSB7T2JqZWN0fSBzZXR0aW5ncyBzZXR0aW5ncyBvZiBuYXZpZ2F0aW9uDQogICAgICogQHBhcmFtIHtPYmplY3R9ICRjb250YWluZXIgICAgbmF2aWdhdGlvbiBpdGVtcyBjb250YWluZXIgKGpRdWVyeSBvYmplY3QpDQogICAgICovDQogICAgTmF2aWdhdGlvbi5wcm90b3R5cGUucHJlcGFyZVByZXZOZXh0SXRlbXMgPSBmdW5jdGlvbihzZXR0aW5ncywgJGNvbnRhaW5lcikgew0KICAgICAgICB2YXIgJGl0ZW07DQoNCiAgICAgICAgc2V0dGluZ3MucHJldkl0ZW0ubWV0aG9kID0gJ3ByZXBlbmQnOw0KICAgICAgICAkaXRlbSA9IE5hdmlnYXRpb25CdWlsZGVyLmNyZWF0ZVByZXZOZXh0SXRlbShzZXR0aW5ncy5wcmV2SXRlbSwgew0KICAgICAgICAgICAgJ2NsYXNzJzogJ3ByZXYnDQogICAgICAgIH0sICRjb250YWluZXIpOw0KICAgICAgICB0aGlzLiRwcmV2SXRlbSA9ICgkaXRlbSA9PT0gbnVsbCkgPyB0aGlzLiRwcmV2SXRlbSA6ICRpdGVtOw0KDQogICAgICAgIHNldHRpbmdzLm5leHRJdGVtLm1ldGhvZCA9ICdhcHBlbmQnOw0KICAgICAgICAkaXRlbSA9IE5hdmlnYXRpb25CdWlsZGVyLmNyZWF0ZVByZXZOZXh0SXRlbShzZXR0aW5ncy5uZXh0SXRlbSwgew0KICAgICAgICAgICAgJ2NsYXNzJzogJ25leHQnDQogICAgICAgIH0sICRjb250YWluZXIpOw0KICAgICAgICB0aGlzLiRuZXh0SXRlbSA9ICgkaXRlbSA9PT0gbnVsbCkgPyB0aGlzLiRuZXh0SXRlbSA6ICRpdGVtOw0KICAgIH07DQogICAgLyoqDQogICAgICogZW5kIG9mIE5hdmlnYXRpb24gY2xhc3MNCiAgICAgKi8NCg0KICAgIC8qKg0KICAgICAqIFNsaWRlckNvbnRleHQgY2xhc3MgaXMgYmluZGVkIHRvIGEgU2xpZGVyIGNsYXNzIGluc3RhbmNlDQogICAgICogYW5kIGhvbGRzIGl0cyBwcm9wZXJ0aWVzLg0KICAgICAqIEBjb25zdHJ1Y3Rvcg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIFNsaWRlckNvbnRleHQoKSB7DQogICAgICAgIC8qKg0KICAgICAgICAgKiBGbGFnLCB3aGljaCBkZXRlcm1pbmVzIGlmIHNsaWRlIGNhbiBvciBjYW4gbm90IGJlIGNoYW5nZWQgKGZvciB1c2VyIHJlcXVlc3QpDQogICAgICAgICAqDQogICAgICAgICAqIEBtZW1iZXIgU2xpZGVyQ29udGV4dA0KICAgICAgICAgKi8NCiAgICAgICAgdGhpcy5jYW5DaGFuZ2VTbGlkZSA9IHRydWU7DQogICAgICAgIC8qKg0KICAgICAgICAgKiBEZWZhdWx0IFNsaWRlciBzZXR0aW5nIG9iamVjdCAoQHNlZSBTbGlkZXIpDQogICAgICAgICAqDQogICAgICAgICAqIEBtZW1iZXIgU2xpZGVyQ29udGV4dA0KICAgICAgICAgKi8NCiAgICAgICAgdGhpcy5kZWZhdWx0cyA9IG51bGw7DQogICAgICAgIC8qKg0KICAgICAgICAgKiBOYXZpZ2F0aW9uIG9iamVjdCAoQHNlZSBOYXZpZ2F0aW9uKQ0KICAgICAgICAgKg0KICAgICAgICAgKiBAbWVtYmVyIFNsaWRlckNvbnRleHQNCiAgICAgICAgICovDQogICAgICAgIHRoaXMubmF2aWdhdGlvbiA9IG51bGw7DQogICAgICAgIC8qKg0KICAgICAgICAgKiBTbGlkZXIgb2JqZWN0LCB3aGljaCB0aGlzIGNvbnRleHQgaXMgYXR0YWNlaGQgdG8uDQogICAgICAgICAqDQogICAgICAgICAqIEBtZW1iZXIgU2xpZGVyQ29udGV4dA0KICAgICAgICAgKi8NCiAgICAgICAgdGhpcy5vd25lciA9IG51bGw7DQogICAgICAgIC8qKg0KICAgICAgICAgKiBGbGFnLCB3aGljaCBkZXRlcm1pbmVzIGlmIGNoYW5nZSBvZiBhIHNsaWRlIGNhbiBvciBjYW4gbm90IGJlIHNjaGVkdWxlZA0KICAgICAgICAgKg0KICAgICAgICAgKiBAbWVtYmVyIFNsaWRlckNvbnRleHQNCiAgICAgICAgICovDQogICAgICAgIHRoaXMucHJldmVudFNjaGVkdWxpbmcgPSBmYWxzZTsNCiAgICAgICAgLyoqDQogICAgICAgICAqIFNsaWRlciBzZXR0aW5nIG9iamVjdA0KICAgICAgICAgKg0KICAgICAgICAgKiBAbWVtYmVyIFNsaWRlckNvbnRleHQNCiAgICAgICAgICovDQogICAgICAgIHRoaXMuc2V0dGluZ3MgPSBudWxsOw0KICAgICAgICAvKioNCiAgICAgICAgICogSW5zdGFuY2Ugb2YgVGltZXIgY2xhc3MgKEBzZWUgVGltZXIpLCB3aGljaCBpcyB1c2VkIHRvIHN0b3JlIGhvdyBtdWNoDQogICAgICAgICAqIHRpbWUgaXMgbGVmdCB0byBjaGFuZ2UgdGhlIHNsaWRlDQogICAgICAgICAqDQogICAgICAgICAqIEBtZW1iZXIgU2xpZGVyQ29udGV4dA0KICAgICAgICAgKi8NCiAgICAgICAgdGhpcy5zbGlkZVRpbWVyID0gbmV3IFRpbWVyKCk7DQogICAgICAgIC8qKg0KICAgICAgICAgKiBJbnN0YW5jZSBvZiBUaW1lSW5kaWNhdG9yIGNsYXNzIChAc2VlIFRpbWVJbmRpY2F0b3IpDQogICAgICAgICAqDQogICAgICAgICAqIEBtZW1iZXIgU2xpZGVyQ29udGV4dA0KICAgICAgICAgKi8NCiAgICAgICAgdGhpcy50aW1lSW5kaWNhdG9yID0gbnVsbDsNCiAgICAgICAgLyoqDQogICAgICAgICAqIFRpbWVycyBhcnJheS4NCiAgICAgICAgICoNCiAgICAgICAgICogQG1lbWJlciBTbGlkZXJDb250ZXh0DQogICAgICAgICAqLw0KICAgICAgICB0aGlzLnRpbWVycyA9IFtdOw0KICAgICAgICAvKioNCiAgICAgICAgICogTGFzdCB0aW1lb3V0IGlkZW50aWZpZXIuDQogICAgICAgICAqDQogICAgICAgICAqIEBtZW1iZXIgU2xpZGVyQ29udGV4dA0KICAgICAgICAgKi8NCiAgICAgICAgdGhpcy50aW1lb3V0SWQgPSBudWxsOw0KICAgICAgICAvKioNCiAgICAgICAgICogVHJhbnNpdGlvbiAoQHNlZSBYQS5jb21wb25lbnQuY2Fyb3VzZWxzLlRyYW5zaXRpb25zLlRyYW5zaXRpb24pIHVzZWQgd2hpbGUgY2hhbmdpbmcgc2xpZGVzDQogICAgICAgICAqDQogICAgICAgICAqIEBtZW1iZXIgU2xpZGVyQ29udGV4dA0KICAgICAgICAgKi8NCiAgICAgICAgdGhpcy50cmFuc2l0aW9uID0gbnVsbDsNCiAgICAgICAgLyoqDQogICAgICAgICAqIFRyYW5zaXRpb24gc2V0dGluZ3Mgb2JqZWN0IChAc2VlIFhBLmNvbXBvbmVudC5jYXJvdXNlbHMuVHJhbnNpdGlvbnMuVHJhbnNpdGlvblNldHRpbmdzKQ0KICAgICAgICAgKg0KICAgICAgICAgKiBAbWVtYmVyIFNsaWRlckNvbnRleHQNCiAgICAgICAgICovDQogICAgICAgIHRoaXMudHJhbnNpdGlvblNldHRpbmdzID0gbmV3IFhBLmNvbXBvbmVudC5jYXJvdXNlbHMuVHJhbnNpdGlvbnMuVHJhbnNpdGlvblNldHRpbmdzKCk7DQogICAgICAgIC8qKg0KICAgICAgICAgKiBqUXVlcnkgb2JqZWN0IHdoaWNoIGNvbnRhaW5zIGFsbCBzbGlkZXMNCiAgICAgICAgICoNCiAgICAgICAgICogQG1lbWJlciBTbGlkZXJDb250ZXh0DQogICAgICAgICAqLw0KICAgICAgICB0aGlzLiRzbGlkZXMgPSBudWxsOw0KICAgICAgICAvKioNCiAgICAgICAgICogalF1ZXJ5IG9iamVjdCBjb250YWluaW5nIGVsZW1lbnQgdGhhdCB3cmFwcHMgc2xpZGVzDQogICAgICAgICAqDQogICAgICAgICAqIEBtZW1iZXIgU2xpZGVyQ29udGV4dA0KICAgICAgICAgKi8NCiAgICAgICAgdGhpcy4kd3JhcHBlciA9IG51bGw7DQogICAgICAgIC8qKg0KICAgICAgICAgKiBSZWZlcmVuY2UgdG8gbWV0aG9kLCB3aGljaCBzaG91bGQgY2hhbmdlIGN1cnJlbnQgc2xpZGUNCiAgICAgICAgICoNCiAgICAgICAgICogQG1lbWJlciBTbGlkZXJDb250ZXh0DQogICAgICAgICAqLw0KICAgICAgICB0aGlzLmNoYW5nZUN1cnJlbnRTbGlkZSA9IG51bGw7DQogICAgICAgIC8qKg0KICAgICAgICAgKiBSZWZlcmVuY2UgdG8gbWV0aG9kLCB3aGljaCBzaG91bGQgcmV0dXJuIGpRdWVyeSBvYmplY3Qgd2l0aCBjdXJyZW50IHNsaWRlDQogICAgICAgICAqDQogICAgICAgICAqIEBtZW1iZXIgU2xpZGVyQ29udGV4dA0KICAgICAgICAgKi8NCiAgICAgICAgdGhpcy5nZXRDdXJyZW50U2xpZGUgPSBudWxsOw0KDQogICAgICAgIHRoaXMudGltZXJzLnB1c2godGhpcy5zbGlkZVRpbWVyKTsNCiAgICB9DQogICAgLyoqDQogICAgICogZW5kIG9mIFNsaWRlckNvbnRleHQgY2xhc3MNCiAgICAgKi8NCg0KICAgIC8qKg0KICAgICAqIFNsaWRlciBjbGFzcyBtYW5hZ2VzIGNoYW5naW5nIG9mIHNsaWRlcy4NCiAgICAgKg0KICAgICAqIE9wdGlvbnMgb2JqZWN0Og0KICAgICAqIHsNCiAgICAgKiAgICAgJ25hdmlnYXRpb24nOiBPYmplY3QgdmFsdWUsIC8vbmF2aWdhdGlvbiBzZXR0aW5ncyBvYmplY3QNCiAgICAgKiAgICAgJ3RpbWVvdXQnOiBOdW1iZXIgdmFsdWUsIC8vdGltZSBiZXR3ZWVuIHNsaWRlcyBjaGFuZ2luZw0KICAgICAqICAgICAndHJhbnNpdGlvbic6IFN0cmluZyB2YWx1ZSwgLy9uYW1lIG9mIHRyYW5zaXRpb24gY2xhc3MgKEBzZWUgWEEuY29tcG9uZW50LmNhcm91c2Vscy5UcmFuc2l0aW9ucy5UcmFuc2l0aW9uKQ0KICAgICAqICAgICAnaXNQYXVzZUVuYWJsZWQnOiBCb29sZWFuIHZhbHVlLCAvL2ZsYWcsIHdoaWNoIGRldGVybWluZXMgaWYgcGF1c2UgZmVhdHVyZSBpcyBlbmFibGVkDQogICAgICogICAgICd0aW1lSW5kaWNhdG9yJzogew0KICAgICAqICAgICAgICAgJ2lzRW5hYmxlZCc6IEJvb2xlYW4gdmFsdWUsIC8vZmxhZywgd2hpY2ggZGV0ZXJtaW5lcyBpZiB0aW1lIGluZGljYXRvciBpcyBlbmFibGVkDQogICAgICogICAgICAgICAnc2VsZWN0b3InOiBTdHJpbmcgdmFsdWUsIC8vc2VsZWN0b3Igb2YgdGltZSBpbmRpY2F0b3IgaHRtbCBlbGVtZW50DQogICAgICogICAgICAgICAndmlldyc6IFN0cmluZyB2YWx1ZSwgLy9uYW1lIG9mIHZpZXcgY2xhc3MgKEBzZWUgWEEuY29tcG9uZW50LmNhcm91c2Vscy5JbmRpY2F0b3JWaWV3cy5WaWV3DQogICAgICogICAgICAgICAnb3B0aW9ucyc6IE9iamVjdCB2YWx1ZSAvL29iamVjdCB3aXRoIG9wdGlvbnMsIHdoaWNoIHdpbGwgYmUgcGFzc2VkIHRvIGEgdGltZSBpbmRpY2F0b3Igdmlldw0KICAgICAqICAgICB9DQogICAgICogfQ0KICAgICAqIEBjb25zdHJ1Y3Rvcg0KICAgICAqIEBwYXJhbSB7T2JqZWN0fSAkICAgICB0aGUgalF1ZXJ5IG9iamVjdA0KICAgICAqIEBwYXJhbSB7U2xpZGVyQ29udGV4dH0gY29udGV4dCAgICBpbnN0YW5jZSBvZiBTbGlkZXJDb250ZXh0IGNsYXNzOyBtdXN0IGJlIHNlcGFyYXRlIGZvciBlYWNoIGluc3RhbmNlIChAc2VlIFNsaWRlckNvbnRleHQpDQogICAgICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnMgICAgU2xpZGVyIG9wdGlvbnMgb2JqZWN0DQogICAgICovDQogICAgZnVuY3Rpb24gU2xpZGVyKCQsIGNvbnRleHQsIG9wdGlvbnMpIHsNCiAgICAgICAgdmFyIGRlZmF1bHRzID0gew0KICAgICAgICAgICAgJ25hdmlnYXRpb24nOiB7fSwNCiAgICAgICAgICAgICd0aW1lb3V0JzogMTAwMDAsDQogICAgICAgICAgICAndHJhbnNpdGlvbic6ICdCYXNpY1RyYW5zaXRpb24nLA0KICAgICAgICAgICAgJ2lzUGF1c2VFbmFibGVkJzogdHJ1ZSwNCiAgICAgICAgICAgICd0aW1lSW5kaWNhdG9yJzogew0KICAgICAgICAgICAgICAgICdpc0VuYWJsZWQnOiBmYWxzZSwNCiAgICAgICAgICAgICAgICAnc2VsZWN0b3InOiBudWxsLA0KICAgICAgICAgICAgICAgICd2aWV3JzogJ1ZpZXcnLA0KICAgICAgICAgICAgICAgICdvcHRpb25zJzoge30NCiAgICAgICAgICAgIH0NCiAgICAgICAgfTsNCg0KICAgICAgICAvKioNCiAgICAgICAgICogSW5zdGFuY2Ugb2YgU2xpZGVyQ29udGV4dCBjbGFzcyAoQHNlZSBTbGlkZXJDb250ZXh0KQ0KICAgICAgICAgKg0KICAgICAgICAgKiBAbWVtYmVyIE5hdmlnYXRpb24NCiAgICAgICAgICovDQogICAgICAgIHRoaXMuY29udGV4dCA9IGNvbnRleHQ7DQoNCiAgICAgICAgY29udGV4dC5vd25lciA9IHRoaXM7DQogICAgICAgIGNvbnRleHQuZGVmYXVsdHMgPSBkZWZhdWx0czsNCiAgICAgICAgY29udGV4dC5zZXR0aW5ncyA9ICQuZXh0ZW5kKHRydWUsIHt9LCBkZWZhdWx0cywgb3B0aW9ucyk7DQogICAgICAgIGNvbnRleHQudHJhbnNpdGlvblNldHRpbmdzLiRzbGlkZXMgPSBjb250ZXh0LiRzbGlkZXM7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogRXhlY3V0ZXMgbWV0aG9kIHdpdGggZ2l2ZW4gbWV0aG9kTmFtZSBvbiBlYWNoIFRpbWVyIGluIGNvbnRleHQudGltZXJzIChAc2VlIFRpbWVyKQ0KICAgICAqDQogICAgICogQG1lbWJlciBTbGlkZXINCiAgICAgKiBAcGFyYW0ge1N0cmluZ30gbWV0aG9kTmFtZSAgIG5hbWUgb2YgYSBtZXRob2QsIHdoaWNoIHdpbGwgYmUgZXhlY3V0ZWQgb24gdGltZXJzDQogICAgICogQHBhcmFtIHtTbGlkZXJDb250ZXh0fSBjb250ZXh0ICAgIGN1cnJlbnQgY29udGV4dA0KICAgICAqLw0KICAgIFNsaWRlci5wcm90b3R5cGUuZXhlY3V0ZU9uVGltZXJzID0gZnVuY3Rpb24obWV0aG9kTmFtZSwgY29udGV4dCkgew0KICAgICAgICB2YXIgaSA9IG51bGwsDQogICAgICAgICAgICB0aW1lciA9IG51bGwsDQogICAgICAgICAgICB0aW1lcnMgPSBjb250ZXh0LnRpbWVyczsNCg0KICAgICAgICBmb3IgKGkgPSAwOyBpIDwgdGltZXJzLmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgICB0aW1lciA9IHRpbWVyc1tpXTsNCiAgICAgICAgICAgIGlmICh0eXBlb2YodGltZXJbbWV0aG9kTmFtZV0pID09PSAnZnVuY3Rpb24nKSB7DQogICAgICAgICAgICAgICAgdGltZXJbbWV0aG9kTmFtZV0oKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH07DQoNCiAgICAvKioNCiAgICAgKiBEZXNjaGVkdWxlcyBjaGFuZ2Ugb2YgYSBzbGlkZSwgYnkgY2xlYXJpbmcgdGltZW91dCBwcmV2aW91c2x5IHNldCBieSBzZXRUaWVtb3V0KCkgZnVuY3Rpb24uDQogICAgICoNCiAgICAgKiBAbWVtYmVyIFNsaWRlcg0KICAgICAqIEBwYXJhbSB7U2xpZGVyQ29udGV4dH0gY29udGV4dCAgICBjdXJyZW50IGNvbnRleHQNCiAgICAgKi8NCiAgICBTbGlkZXIucHJvdG90eXBlLmRlc2NoZWR1bGVTbGlkZSA9IGZ1bmN0aW9uKGNvbnRleHQpIHsNCiAgICAgICAgaWYgKGNvbnRleHQudGltZW91dElkICE9PSBudWxsKSB7DQogICAgICAgICAgICBjbGVhclRpbWVvdXQoY29udGV4dC50aW1lb3V0SWQpOw0KICAgICAgICAgICAgY29udGV4dC50aW1lb3V0SWQgPSBudWxsOw0KICAgICAgICB9DQogICAgfTsNCg0KICAgIC8qKg0KICAgICAqIFNjaGVkdWxlcyBjaGFuZ2Ugb2YgYSBzbGlkZSwgYnkgc2V0dGluZyB0aW1lb3V0ICh1c2luZyBzZXRUaWVtb3V0KCkgZnVuY3Rpb24pIGlmIGNhbi4NCiAgICAgKiBJZiBjYW4ndCwgdHJpZXMgYWdhaW4gYWZ0ZXIgc2hvcnQgcGVyaW9kIG9mIHRpbWUuDQogICAgICoNCiAgICAgKiBAbWVtYmVyIFNsaWRlcg0KICAgICAqIEBwYXJhbSB7U2xpZGVyQ29udGV4dH0gY29udGV4dCAgICBjdXJyZW50IGNvbnRleHQNCiAgICAgKi8NCiAgICBTbGlkZXIucHJvdG90eXBlLnNjaGVkdWxlU2xpZGUgPSBmdW5jdGlvbihjb250ZXh0KSB7DQogICAgICAgIHZhciBvd25lciA9IGNvbnRleHQub3duZXI7DQoNCiAgICAgICAgb3duZXIuZGVzY2hlZHVsZVNsaWRlKGNvbnRleHQpOw0KDQogICAgICAgIGlmICghY29udGV4dC5wcmV2ZW50U2NoZWR1bGluZyAmJiBjb250ZXh0LiRzbGlkZXMuc2l6ZSgpID4gMSkgew0KICAgICAgICAgICAgb3duZXIuZXhlY3V0ZU9uVGltZXJzKCdzZXQnLCBjb250ZXh0KTsNCg0KICAgICAgICAgICAgaWYgKGNvbnRleHQuY2FuQ2hhbmdlU2xpZGUpIHsNCiAgICAgICAgICAgICAgICBpZiAoY29udGV4dC50aW1lSW5kaWNhdG9yICE9PSBudWxsKSB7DQogICAgICAgICAgICAgICAgICAgIGNvbnRleHQudGltZUluZGljYXRvci5wbGF5KCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGNvbnRleHQudGltZW91dElkID0gc2V0VGltZW91dChmdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgICAgICAgb3duZXIuY2hhbmdlQ3VycmVudFNsaWRlQnkoMSwgY29udGV4dCk7DQogICAgICAgICAgICAgICAgfSwgY29udGV4dC5zZXR0aW5ncy50aW1lb3V0IC0gY29udGV4dC5zbGlkZVRpbWVyLmVsYXBzZWQpOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgICAgICBvd25lci5zY2hlZHVsZVNsaWRlKGNvbnRleHQpOw0KICAgICAgICAgICAgICAgIH0sIDEwMCk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9Ow0KDQogICAgLyoqDQogICAgICogQ2hhbmdlcyBjdXJyZW50IHNsaWRlLCBieSBvZmZzZXQgcGVyZm9ybWluZyBjb250ZXh0LnRyYW5zaXRpb24NCiAgICAgKiBBbnkgb2Zmc2V0IHZhbHVlIGlzIHNhdmUgKGlmIGl0IGlzIGFuIGludGVnZXIpLg0KICAgICAqDQogICAgICogQG1lbWJlciBTbGlkZXINCiAgICAgKiBAcGFyYW0ge051bWJlcn0gb2Zmc2V0ICAgIHRoZSBvZmZzZXQgdG8gYW4gaW5kZXggb2YgYSBuZXcgc2xpZGUNCiAgICAgKiBAcGFyYW0ge1NsaWRlckNvbnRleHR9IGNvbnRleHQgICAgY3VycmVudCBjb250ZXh0DQogICAgICovDQogICAgU2xpZGVyLnByb3RvdHlwZS5jaGFuZ2VDdXJyZW50U2xpZGVCeSA9IGZ1bmN0aW9uKG9mZnNldCwgY29udGV4dCkgew0KICAgICAgICB2YXIgc2V0dGluZ3MgPSBjb250ZXh0LnRyYW5zaXRpb25TZXR0aW5ncywNCiAgICAgICAgICAgICRjdXJyZW50U2xpZGUgPSBjb250ZXh0LmdldEN1cnJlbnRTbGlkZSgpLA0KICAgICAgICAgICAgJHNsaWRlcyA9IGNvbnRleHQuJHNsaWRlczsNCg0KICAgICAgICBpZiAoKG9mZnNldCAlICRzbGlkZXMuc2l6ZSgpKSAhPT0gMCkgew0KICAgICAgICAgICAgY29udGV4dC5jYW5DaGFuZ2VTbGlkZSA9IGZhbHNlOw0KDQogICAgICAgICAgICBzZXR0aW5ncy5vZmZzZXQgPSBvZmZzZXQ7DQogICAgICAgICAgICBzZXR0aW5ncy4kY3VycmVudFNsaWRlID0gJGN1cnJlbnRTbGlkZTsNCiAgICAgICAgICAgIHNldHRpbmdzLiRuZXh0U2xpZGUgPSAkc2xpZGVzLmVxKCgkY3VycmVudFNsaWRlLmluZGV4KCkgKyBvZmZzZXQpICUgJHNsaWRlcy5zaXplKCkpOw0KDQogICAgICAgICAgICBjb250ZXh0LmNoYW5nZUN1cnJlbnRTbGlkZShzZXR0aW5ncy4kbmV4dFNsaWRlKTsNCiAgICAgICAgICAgIGNvbnRleHQudHJhbnNpdGlvbi5wZXJmb3JtKGNvbnRleHQudHJhbnNpdGlvblNldHRpbmdzKTsNCiAgICAgICAgICAgIGNvbnRleHQub3duZXIuZXhlY3V0ZU9uVGltZXJzKCdyZXNldCcsIGNvbnRleHQpOw0KICAgICAgICB9DQoNCg0KICAgICAgICB2YXIgJGNhcm91c2VsID0gJChjb250ZXh0LiR3cmFwcGVyKS5wYXJlbnRzKCIuY2Fyb3VzZWwiKTsNCiAgICAgICAgJGNhcm91c2VsLnRyaWdnZXIoInNsaWRlLWNoYW5nZWQiKTsNCiAgICB9Ow0KDQogICAgLyoqDQogICAgICogU3RhcnRzIGF1dG9tYXRpYyBzbGlkZXMgY2hhbmdpbmcNCiAgICAgKg0KICAgICAqIEBtZW1iZXIgU2xpZGVyDQogICAgICovDQogICAgU2xpZGVyLnByb3RvdHlwZS5ydW4gPSBmdW5jdGlvbigpIHsNCiAgICAgICAgdGhpcy5leGVjdXRlT25UaW1lcnMoJ3Jlc2V0JywgdGhpcy5jb250ZXh0KTsNCiAgICAgICAgdGhpcy5zY2hlZHVsZVNsaWRlKHRoaXMuY29udGV4dCk7DQogICAgfTsNCg0KICAgIC8qKg0KICAgICAqIENhbmNlbCB0aGUgZGVmYXVsdCBhY3Rpb24gb2YgZXZlbnQgYW5kIGNoYW5nZXMgc2xpZGUgbWFudWFsbHkuDQogICAgICoNCiAgICAgKiBAbWVtYmVyIFNsaWRlcg0KICAgICAqIEBwYXJhbSB7T2JqZWN0fSBldmVudCAgICAgdGhlIGV2ZW50DQogICAgICogQHBhcmFtIHtOdW1iZXJ9IG9mZnNldCAgICB0aGUgb2Zmc2V0IHRvIGFuIGluZGV4IG9mIGEgbmV3IHNsaWRlDQogICAgICogQHBhcmFtIHtTbGlkZXJDb250ZXh0fSBjb250ZXh0ICAgIGN1cnJlbnQgY29udGV4dA0KICAgICAqLw0KICAgIFNsaWRlci5wcm90b3R5cGUub25DaGFuZ2VDdXJyZW50U2xpZGUgPSBmdW5jdGlvbihldmVudCwgb2Zmc2V0LCBjb250ZXh0KSB7DQogICAgICAgIHZhciBvd25lciA9IGNvbnRleHQub3duZXI7DQoNCiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsNCiAgICAgICAgaWYgKGNvbnRleHQuY2FuQ2hhbmdlU2xpZGUpIHsNCiAgICAgICAgICAgIG93bmVyLmRlc2NoZWR1bGVTbGlkZShjb250ZXh0KTsNCiAgICAgICAgICAgIG93bmVyLmNoYW5nZUN1cnJlbnRTbGlkZUJ5KG9mZnNldCwgY29udGV4dCk7DQogICAgICAgIH0NCiAgICB9Ow0KDQogICAgLyoqDQogICAgICogU2VsZWN0cyBuYXZpZ2F0aW9uIGl0ZW0gd2l0aCBnaXZlbiBpbmRleC4NCiAgICAgKg0KICAgICAqIEBtZW1iZXIgU2xpZGVyDQogICAgICogQHBhcmFtIHtOdW1iZXJ9IGluZGV4ICAgICB0aGUgaW5kZXggb2YgbmF2aWdhdGlvbiBpdGVtDQogICAgICovDQogICAgU2xpZGVyLnByb3RvdHlwZS5zZWxlY3ROYXZpZ2F0aW9uSXRlbSA9IGZ1bmN0aW9uKGluZGV4KSB7DQogICAgICAgIHRoaXMuY29udGV4dC5uYXZpZ2F0aW9uLnNlbGVjdEl0ZW0oaW5kZXgpOw0KICAgIH07DQogICAgLyoqDQogICAgICogZW5kIG9mIFNsaWRlciBjbGFzcw0KICAgICAqLw0KDQogICAgLyoqDQogICAgICogU2xpZGVySW5pdGlhbGl6ZXIgb2JqZWN0IHNldCB1cCBpbnN0YW5jZXMgb2YgU2xpZGVyIGNsYXNzDQogICAgICovDQogICAgU2xpZGVySW5pdGlhbGl6ZXIgPSAoZnVuY3Rpb24oJCkgew0KICAgICAgICAvKioNCiAgICAgICAgICogQXR0YWNoZXMgZXZlbnRzIHRvIG5hdmlnYXRpb24gaXRlbXMuDQogICAgICAgICAqDQogICAgICAgICAqIEBwYXJhbSB7U2xpZGVyQ29udGV4dH0gY29udGV4dCAgIGEgY29udGV4dCBvZiBhIFNsaWRlciBjbGFzcyBpbnN0YW5jZQ0KICAgICAgICAgKi8NCiAgICAgICAgZnVuY3Rpb24gYXR0YWNoTmF2aWdhdGlvbkV2ZW50cyhjb250ZXh0KSB7DQogICAgICAgICAgICB2YXIgb3duZXIgPSBjb250ZXh0Lm93bmVyLA0KICAgICAgICAgICAgICAgICRuYXZMaW5rcyA9IGNvbnRleHQuJHdyYXBwZXIuZmluZCgiLm5hdiBhIiksDQogICAgICAgICAgICAgICAgJHByZXZJdGVtVHh0ID0gY29udGV4dC4kd3JhcHBlci5maW5kKCcucHJldi10ZXh0JyksDQogICAgICAgICAgICAgICAgJG5leHRJdGVtVHh0ID0gY29udGV4dC4kd3JhcHBlci5maW5kKCcubmV4dC10ZXh0Jyk7DQoNCiAgICAgICAgICAgIGNvbnRleHQubmF2aWdhdGlvbi4kaXRlbXMuZWFjaChmdW5jdGlvbihpbmRleCkgew0KICAgICAgICAgICAgICAgIHZhciAkc2xpZGUgPSBjb250ZXh0LiRzbGlkZXMuZXEoaW5kZXgpOw0KDQogICAgICAgICAgICAgICAgJCh0aGlzKS5jbGljayhmdW5jdGlvbihldmVudCkgew0KICAgICAgICAgICAgICAgICAgICBvd25lci5vbkNoYW5nZUN1cnJlbnRTbGlkZShldmVudCwgJHNsaWRlLmluZGV4KCkgLSBjb250ZXh0LmdldEN1cnJlbnRTbGlkZSgpLmluZGV4KCksIGNvbnRleHQpOw0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgfSk7DQoNCiAgICAgICAgICAgICRwcmV2SXRlbVR4dC5jbGljayhmdW5jdGlvbihldmVudCkgew0KICAgICAgICAgICAgICAgIG93bmVyLm9uQ2hhbmdlQ3VycmVudFNsaWRlKGV2ZW50LCAtMSwgY29udGV4dCk7DQogICAgICAgICAgICB9KTsNCg0KICAgICAgICAgICAgJG5leHRJdGVtVHh0LmNsaWNrKGZ1bmN0aW9uKGV2ZW50KSB7DQogICAgICAgICAgICAgICAgb3duZXIub25DaGFuZ2VDdXJyZW50U2xpZGUoZXZlbnQsIDEsIGNvbnRleHQpOw0KICAgICAgICAgICAgfSk7DQoNCiAgICAgICAgICAgIGNvbnRleHQubmF2aWdhdGlvbi4kcHJldkl0ZW0uY2xpY2soZnVuY3Rpb24oZXZlbnQpIHsNCiAgICAgICAgICAgICAgICBvd25lci5vbkNoYW5nZUN1cnJlbnRTbGlkZShldmVudCwgLTEsIGNvbnRleHQpOw0KICAgICAgICAgICAgfSk7DQoNCiAgICAgICAgICAgIGNvbnRleHQubmF2aWdhdGlvbi4kbmV4dEl0ZW0uY2xpY2soZnVuY3Rpb24oZXZlbnQpIHsNCiAgICAgICAgICAgICAgICBvd25lci5vbkNoYW5nZUN1cnJlbnRTbGlkZShldmVudCwgMSwgY29udGV4dCk7DQogICAgICAgICAgICB9KTsNCg0KICAgICAgICAgICAgJG5hdkxpbmtzLm9uKCJrZXlkb3duIiwgZnVuY3Rpb24oZXZlbnQpew0KICAgICAgICAgICAgICAgIHN3aXRjaChldmVudC5rZXlDb2RlKXsNCiAgICAgICAgICAgICAgICAgICAgY2FzZSAzNzoNCiAgICAgICAgICAgICAgICAgICAgICAgIG93bmVyLm9uQ2hhbmdlQ3VycmVudFNsaWRlKGV2ZW50LCAtMSwgY29udGV4dCk7DQogICAgICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLnBhcmVudCgpLmZpbmQoIi5hY3RpdmUiKS5mb2N1cygpOw0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgICAgIGNhc2UgMzk6DQogICAgICAgICAgICAgICAgICAgICAgICBvd25lci5vbkNoYW5nZUN1cnJlbnRTbGlkZShldmVudCwgMSwgY29udGV4dCk7DQogICAgICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLnBhcmVudCgpLmZpbmQoIi5hY3RpdmUiKS5mb2N1cygpOw0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0NCg0KICAgICAgICAvKioNCiAgICAgICAgICogQXR0YWNoZXMgcGF1c2UgZXZlbnQgdG8gbmF2aWdhdGlvbiB3cmFwcGVyLg0KICAgICAgICAgKg0KICAgICAgICAgKiBAcGFyYW0ge1NsaWRlckNvbnRleHR9IGNvbnRleHQgICBhIGNvbnRleHQgb2YgYSBTbGlkZXIgY2xhc3MgaW5zdGFuY2UNCiAgICAgICAgICovDQogICAgICAgIGZ1bmN0aW9uIGF0dGFjaFBhdXNlRXZlbnQoY29udGV4dCkgew0KICAgICAgICAgICAgdmFyIG93bmVyID0gY29udGV4dC5vd25lciwNCiAgICAgICAgICAgICAgICAkZWxlbWVudCA9IGNvbnRleHQuJHdyYXBwZXIsDQogICAgICAgICAgICAgICAgJG5hdkxpbmtzID0gJGVsZW1lbnQuZmluZCgiLm5hdiBhIik7DQoNCiAgICAgICAgICAgIHZhciBjYWxsYmFja01vdXNlZW50ZXIgPSBmdW5jdGlvbigpew0KICAgICAgICAgICAgICAgIGNvbnRleHQucHJldmVudFNjaGVkdWxpbmcgPSB0cnVlOw0KICAgICAgICAgICAgICAgIG93bmVyLmRlc2NoZWR1bGVTbGlkZShjb250ZXh0KTsNCg0KICAgICAgICAgICAgICAgIG93bmVyLmV4ZWN1dGVPblRpbWVycygndXBkYXRlJywgY29udGV4dCk7DQogICAgICAgICAgICAgICAgaWYgKGNvbnRleHQudGltZUluZGljYXRvciAhPT0gbnVsbCkgew0KICAgICAgICAgICAgICAgICAgICBjb250ZXh0LnRpbWVJbmRpY2F0b3IucGF1c2UoKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICRlbGVtZW50Lm1vdXNlZW50ZXIoY2FsbGJhY2tNb3VzZWVudGVyKTsNCiAgICAgICAgICAgICRuYXZMaW5rcy5vbigiZm9jdXMiLCBjYWxsYmFja01vdXNlZW50ZXIpOw0KDQogICAgICAgICAgICB2YXIgY2FsbGJhY2tNb3VzZUxlYXZlID0gZnVuY3Rpb24oKXsNCiAgICAgICAgICAgICAgICBjb250ZXh0LnByZXZlbnRTY2hlZHVsaW5nID0gZmFsc2U7DQogICAgICAgICAgICAgICAgb3duZXIuc2NoZWR1bGVTbGlkZShjb250ZXh0KTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgJGVsZW1lbnQubW91c2VsZWF2ZShjYWxsYmFja01vdXNlTGVhdmUpOw0KICAgICAgICAgICAgJG5hdkxpbmtzLm9uKCJibHVyIiwgY2FsbGJhY2tNb3VzZUxlYXZlKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8qKg0KICAgICAgICAgKiBDcmVhdGVzIHRpbWUgaW5kaWNhdG9yIHZpZXcNCiAgICAgICAgICoNCiAgICAgICAgICogQHBhcmFtIHtTbGlkZXJDb250ZXh0fSBjb250ZXh0ICAgYSBjb250ZXh0IG9mIGEgU2xpZGVyIGNsYXNzIGluc3RhbmNlDQogICAgICAgICAqLw0KICAgICAgICBmdW5jdGlvbiBjcmVhdGVJbmRpY2F0b3IoY29udGV4dCkgew0KICAgICAgICAgICAgdmFyIHNldHRpbmdzID0gY29udGV4dC5zZXR0aW5ncywNCiAgICAgICAgICAgICAgICB0aW1lSW5kaWNhdG9yID0gbnVsbCwNCiAgICAgICAgICAgICAgICBWaWV3Q29uc3RydWN0b3IgPSBYQS5jb21wb25lbnQuY2Fyb3VzZWxzLkluZGljYXRvclZpZXdzW3NldHRpbmdzLnRpbWVJbmRpY2F0b3Iudmlld10sDQogICAgICAgICAgICAgICAgdmlldyA9IG51bGw7DQoNCiAgICAgICAgICAgIGlmIChWaWV3Q29uc3RydWN0b3IgIT09IG51bGwpIHsNCiAgICAgICAgICAgICAgICB2aWV3ID0gbmV3IFZpZXdDb25zdHJ1Y3RvcihzZXR0aW5ncy50aW1lSW5kaWNhdG9yLnNlbGVjdG9yLCBzZXR0aW5ncy50aW1lSW5kaWNhdG9yLm9wdGlvbnMpOw0KICAgICAgICAgICAgICAgIHRpbWVJbmRpY2F0b3IgPSBuZXcgVGltZUluZGljYXRvcigkLCB2aWV3LCBzZXR0aW5ncy50aW1lb3V0KTsNCiAgICAgICAgICAgICAgICBjb250ZXh0LnRpbWVJbmRpY2F0b3IgPSB0aW1lSW5kaWNhdG9yOw0KICAgICAgICAgICAgICAgIGNvbnRleHQudGltZXJzLnB1c2godGltZUluZGljYXRvcik7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICAvKioNCiAgICAgICAgICogQXR0YWNoZXMgZXZlbnRzIHRvIG5hdmlnYXRpb24uDQogICAgICAgICAqDQogICAgICAgICAqIEBwYXJhbSB7U2xpZGVyQ29udGV4dH0gY29udGV4dCAgIGEgY29udGV4dCBvZiBhIFNsaWRlciBjbGFzcyBpbnN0YW5jZQ0KICAgICAgICAgKi8NCiAgICAgICAgZnVuY3Rpb24gaW5pdGlhbGl6ZU5hdmlnYXRpb24oY29udGV4dCkgew0KICAgICAgICAgICAgY29udGV4dC5zZXR0aW5ncy5uYXZpZ2F0aW9uLnNsaWRlc0NvdW50ID0gY29udGV4dC4kc2xpZGVzLmxlbmd0aDsNCiAgICAgICAgICAgIGNvbnRleHQubmF2aWdhdGlvbiA9IG5ldyBOYXZpZ2F0aW9uKCQsIGNvbnRleHQuJHdyYXBwZXIsIGNvbnRleHQuc2V0dGluZ3MubmF2aWdhdGlvbik7DQogICAgICAgICAgICBhdHRhY2hOYXZpZ2F0aW9uRXZlbnRzKGNvbnRleHQpOw0KDQogICAgICAgICAgICBpZiAoY29udGV4dC5zZXR0aW5ncy5pc1BhdXNlRW5hYmxlZCkgew0KICAgICAgICAgICAgICAgIGF0dGFjaFBhdXNlRXZlbnQoY29udGV4dCk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICAvKioNCiAgICAgICAgICogSW5pdGlhbGl6ZXMgdHJhbnNpdGlvbiBmb3IgYSBnaXZlbiBjb250ZXh0Lg0KICAgICAgICAgKg0KICAgICAgICAgKiBAcGFyYW0ge1NsaWRlckNvbnRleHR9IGNvbnRleHQgICBhIGNvbnRleHQgb2YgYSBTbGlkZXIgY2xhc3MgaW5zdGFuY2UNCiAgICAgICAgICovDQogICAgICAgIGZ1bmN0aW9uIGluaXRpYWxpemVUcmFuc2l0aW9uKGNvbnRleHQpIHsNCiAgICAgICAgICAgIHZhciBUcmFuc2l0aW9uQ29uc3RydWN0b3IgPSBudWxsLA0KICAgICAgICAgICAgICAgIG93bmVyID0gY29udGV4dC5vd25lcjsNCg0KICAgICAgICAgICAgY29udGV4dC50cmFuc2l0aW9uU2V0dGluZ3MuY2FsbGJhY2sgPSBmdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgICBjb250ZXh0LmNhbkNoYW5nZVNsaWRlID0gdHJ1ZTsNCg0KICAgICAgICAgICAgICAgIGlmIChjb250ZXh0LnByZXZlbnRTY2hlZHVsaW5nKSB7DQogICAgICAgICAgICAgICAgICAgIG93bmVyLmV4ZWN1dGVPblRpbWVycygncmVzZXQnLCBjb250ZXh0KTsNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICBvd25lci5zY2hlZHVsZVNsaWRlKGNvbnRleHQpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH07DQoNCiAgICAgICAgICAgIFRyYW5zaXRpb25Db25zdHJ1Y3RvciA9IFhBLmNvbXBvbmVudC5jYXJvdXNlbHMuVHJhbnNpdGlvbnNbY29udGV4dC5zZXR0aW5ncy50cmFuc2l0aW9uXTsNCiAgICAgICAgICAgIGlmICgoVHJhbnNpdGlvbkNvbnN0cnVjdG9yID09PSBudWxsKSB8fCAoVHJhbnNpdGlvbkNvbnN0cnVjdG9yID09PSB1bmRlZmluZWQpKSB7DQogICAgICAgICAgICAgICAgVHJhbnNpdGlvbkNvbnN0cnVjdG9yID0gWEEuY29tcG9uZW50LmNhcm91c2Vscy5UcmFuc2l0aW9uc1tjb250ZXh0LmRlZmF1bHRzLnRyYW5zaXRpb25dOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY29udGV4dC50cmFuc2l0aW9uID0gbmV3IFRyYW5zaXRpb25Db25zdHJ1Y3RvcigpOw0KICAgICAgICAgICAgY29udGV4dC50cmFuc2l0aW9uLmluaXQoY29udGV4dC50cmFuc2l0aW9uU2V0dGluZ3MpOw0KICAgICAgICB9DQoNCiAgICAgICAgcmV0dXJuIHsNCiAgICAgICAgICAgIC8qKg0KICAgICAgICAgICAgICogSW5pdGlhbGl6ZXMgU2xpZGVyIG9iamVjdCB3aXRoIGEgZ2l2ZW4gY29udGV4dC4NCiAgICAgICAgICAgICAqDQogICAgICAgICAgICAgKiBAcGFyYW0ge1NsaWRlckNvbnRleHR9IGNvbnRleHQgICBhIGNvbnRleHQgb2YgYSBTbGlkZXIgY2xhc3MgaW5zdGFuY2UNCiAgICAgICAgICAgICAqLw0KICAgICAgICAgICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oY29udGV4dCkgew0KICAgICAgICAgICAgICAgIGluaXRpYWxpemVOYXZpZ2F0aW9uKGNvbnRleHQpOw0KICAgICAgICAgICAgICAgIGluaXRpYWxpemVUcmFuc2l0aW9uKGNvbnRleHQpOw0KDQogICAgICAgICAgICAgICAgaWYgKGNvbnRleHQuc2V0dGluZ3MudGltZUluZGljYXRvci5pc0VuYWJsZWQpIHsNCiAgICAgICAgICAgICAgICAgICAgY3JlYXRlSW5kaWNhdG9yKGNvbnRleHQpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfTsNCiAgICB9KCQpKTsNCiAgICAvKioNCiAgICAgKiBlbmQgb2YgU2xpZGVySW5pdGlhbGl6ZXINCiAgICAgKi8NCg0KICAgIC8qKg0KICAgICAqIENhcm91c2VsIGNsYXNzIGRpc3BsYXlzIG9uZSBzbGlkZSAoc29tZSBjb250ZW50KSBhdCB0aGUgdGltZS4NCiAgICAgKiBJdHMgYmVoYXZpb3VyIGRlcGVuZHMgb24gc2V0dGluZ3MgKHBhc3NlZCB0byBpbml0KCkgbWV0aG9kKS4NCiAgICAgKiBGb3IgbW9yZSBkZXRhaWxzIEBzZWUgU2xpZGVyLCBAc2VlIFNsaWRlckluaXRpYWxpemVyLCBAc2VlIE5hdmlnYXRpb24sDQogICAgICogQHNlZSBOYXZpZ2F0aW9uQnVpbGRlciwgQHNlZSBYQS5jb21wb25lbnQuY2Fyb3VzZWxzLlRyYW5zaXRpb25zLlRyYW5zaXRpb24sDQogICAgICogQHNlZSBYQS5jb21wb25lbnQuY2Fyb3VzZWxzLkluZGljYXRvclZpZXdzLlZpZXcNCiAgICAgKg0KICAgICAqIEBjb25zdHJ1Y3Rvcg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIENhcm91c2VsKCQpIHsNCiAgICAgICAgdmFyIGNvbnRleHQgPSB0aGlzOw0KDQogICAgICAgIC8qKg0KICAgICAgICAgKiBJbnN0YW5jZSBvZiBhIFNsaWRlciBjbGFzcyAoQHNlZSBTbGlkZXIpLg0KICAgICAgICAgKg0KICAgICAgICAgKiBAbWVtYmVyIENhcm91c2VsDQogICAgICAgICAqLw0KICAgICAgICB0aGlzLnNsaWRlciA9IG51bGw7DQogICAgICAgIC8qKg0KICAgICAgICAgKiBEaXNwbGF5ZWQgc2xpZGUgKGpRdWVyeSBvYmplY3QpLg0KICAgICAgICAgKg0KICAgICAgICAgKiBAbWVtYmVyIENhcm91c2VsDQogICAgICAgICAqLw0KICAgICAgICB0aGlzLiRjdXJyZW50U2xpZGUgPSBudWxsOw0KICAgICAgICAvKioNCiAgICAgICAgICogQWxsIHNsaWRlcyAoalF1ZXJ5IG9iamVjdCkuDQogICAgICAgICAqDQogICAgICAgICAqIEBtZW1iZXIgQ2Fyb3VzZWwNCiAgICAgICAgICovDQogICAgICAgIHRoaXMuJHNsaWRlcyA9IG51bGw7DQoNCiAgICAgICAgLyoqDQogICAgICAgICAqIENoYW5nZXMgY3VycmVudCBzbGlkZSB0byBhICRuZXdTbGlkZS4NCiAgICAgICAgICoNCiAgICAgICAgICogQG1lbWJlciBDYXJvdXNlbA0KICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gJG5ld1NsaWRlICB0aGUgbmV3IHNsaWRlIChqUXVlcnkpIG9iamVjdC4NCiAgICAgICAgICovDQogICAgICAgIHRoaXMuY2hhbmdlQ3VycmVudFNsaWRlID0gZnVuY3Rpb24oJG5ld1NsaWRlKSB7DQogICAgICAgICAgICBjb250ZXh0LiRjdXJyZW50U2xpZGUgPSAkbmV3U2xpZGU7DQogICAgICAgICAgICBjb250ZXh0LnNsaWRlci5zZWxlY3ROYXZpZ2F0aW9uSXRlbSgkbmV3U2xpZGUuaW5kZXgoKSk7DQogICAgICAgIH07DQoNCiAgICAgICAgLyoqDQogICAgICAgICAqIFJldHVybnMgY3VycmVudCBzbGlkZS4NCiAgICAgICAgICoNCiAgICAgICAgICogQG1lbWJlciBDYXJvdXNlbA0KICAgICAgICAgKiBAcmV0dXJuIGN1cnJlbnQgc2xpZGUgKGpRdWVyeSkgb2JqZWN0Lg0KICAgICAgICAgKiBAdHlwZSBPYmplY3QNCiAgICAgICAgICovDQogICAgICAgIHRoaXMuZ2V0Q3VycmVudFNsaWRlID0gZnVuY3Rpb24oKSB7DQogICAgICAgICAgICByZXR1cm4gY29udGV4dC4kY3VycmVudFNsaWRlOw0KICAgICAgICB9Ow0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIFJlc2V0cyB0aGUgY2Fyb3VzZWwuDQogICAgICoNCiAgICAgKiBAbWVtYmVyIENhcm91c2VsDQogICAgICovDQogICAgQ2Fyb3VzZWwucHJvdG90eXBlLnJlc2V0ID0gZnVuY3Rpb24oKSB7DQogICAgICAgIHRoaXMuJHNsaWRlcy5lYWNoKGZ1bmN0aW9uKGluZGV4KSB7DQogICAgICAgICAgICAkKHRoaXMpLmhpZGUoKTsNCiAgICAgICAgfSk7DQoNCiAgICAgICAgdGhpcy5jaGFuZ2VDdXJyZW50U2xpZGUodGhpcy4kc2xpZGVzLmZpcnN0KCkpOw0KICAgICAgICB0aGlzLiRjdXJyZW50U2xpZGUuc2hvdygpOw0KICAgIH07DQoNCiAgICAvKioNCiAgICAgKiBJbml0aWFsaXplcyB0aGUgY2Fyb3VzZWwuDQogICAgICogV3JhcHBzIGNhcm91c2VsIGNvbnRlbnQgd2l0aCA8ZGl2IGNsYXNzPSJ3cmFwcGVyIiAvPiBlbGVtZW50LA0KICAgICAqIHNlbGVjdHMgc2xpZGVzICg8bGkgLz4gZWxlbWVudHMpIGZyb20gPHVsIGNsYXNzPSJzbGlkZXMiIC8+IGVsZW1lbnQsDQogICAgICogaW5pdGlhbGl6ZXMgU2xpZGVyIGNsYXNzIGluY3RhbmNlLCByZXNldHMgdGhlIGNhcm91c2VsIGFuZCBzdGFydCBhdXRvbWF0aWMgc2xpZGVzIGNoYW5naW5nLg0KICAgICAqDQogICAgICogQG1lbWJlciBDYXJvdXNlbA0KICAgICAqIEBwYXJhbSB7T2JqZWN0fSAkY29udGFpbmVyICAgICBqUXVlcnkgb2JqZWN0IHdpdGggYSBtYWluIGh0bWwgZWxlbWVudCBvZiB0aGUgY2Fyb3VzZWwNCiAgICAgKiBAcGFyYW0ge09iamVjdH0gb3B0aW9ucyAgICAgY2Fyb3VzZWwgb3B0aW9ucyBvYmplY3QNCiAgICAgKi8NCiAgICBDYXJvdXNlbC5wcm90b3R5cGUuaW5pdCA9IGZ1bmN0aW9uKCRjb250YWluZXIsIG9wdGlvbnMpIHsNCiAgICAgICAgdmFyICR3cmFwcGVyID0gJCgnPGRpdi8+Jywgew0KICAgICAgICAgICAgICAgICdjbGFzcyc6ICd3cmFwcGVyJw0KICAgICAgICAgICAgfSksDQogICAgICAgICAgICBzbGlkZXJDb250ZXh0ID0gbnVsbDsNCg0KICAgICAgICAkd3JhcHBlci5hcHBlbmQoJGNvbnRhaW5lci5jaGlsZHJlbigpLmRldGFjaCgpKTsNCiAgICAgICAgJGNvbnRhaW5lci5hcHBlbmQoJHdyYXBwZXIpOw0KICAgICAgICB0aGlzLiRzbGlkZXMgPSAkY29udGFpbmVyLmZpbmQoJy5zbGlkZXMgbGkuc2xpZGUnKTsNCg0KICAgICAgICBzbGlkZXJDb250ZXh0ID0gbmV3IFNsaWRlckNvbnRleHQoKTsNCiAgICAgICAgc2xpZGVyQ29udGV4dC5jaGFuZ2VDdXJyZW50U2xpZGUgPSB0aGlzLmNoYW5nZUN1cnJlbnRTbGlkZTsNCiAgICAgICAgc2xpZGVyQ29udGV4dC5nZXRDdXJyZW50U2xpZGUgPSB0aGlzLmdldEN1cnJlbnRTbGlkZTsNCiAgICAgICAgc2xpZGVyQ29udGV4dC4kc2xpZGVzID0gdGhpcy4kc2xpZGVzOw0KICAgICAgICBzbGlkZXJDb250ZXh0LiR3cmFwcGVyID0gJHdyYXBwZXI7DQoNCiAgICAgICAgdGhpcy5zbGlkZXIgPSBuZXcgU2xpZGVyKCQsIHNsaWRlckNvbnRleHQsIG9wdGlvbnMpOw0KICAgICAgICBTbGlkZXJJbml0aWFsaXplci5pbml0aWFsaXplKHNsaWRlckNvbnRleHQpOw0KDQogICAgICAgIHRoaXMucmVzZXQoKTsNCiAgICAgICAgdGhpcy5zbGlkZXIucnVuKCk7DQogICAgfTsNCiAgICAvKioNCiAgICAgKiBlbmQgb2YgQ2Fyb3VzZWwgY2xhc3MNCiAgICAgKi8NCg0KICAgIC8qKg0KICAgICAqIFJlZ2lzdGVycyBlYWNoIGVsZW1lbnRzIHRoYXQgbWF0Y2ggdGhlIHByb3ZpZGVkIHNlbGVjdG9yIGFzIGEgY2Fyb3VzZWwgd2l0aCBhIGdpdmVuIG9wdGlvbnMuDQogICAgICogQ2Fyb3VzZWwgb3B0aW9ucyBvYmplY3QgOg0KICAgICAqIHsNCiAgICAgKiAgICAgLy8NCiAgICAgKiAgICAgLy8gbmF2aWdhdGlvbjogT2JqZWN0DQogICAgICogICAgIC8vDQogICAgICogICAgIC8vIFRoZSBuYXZpZ2F0aW9uIGNvbmZpZ3VyYXRpb24gb2JqZWN0Lg0KICAgICAqICAgICAvLw0KICAgICAqICAgICAnbmF2aWdhdGlvbic6IHsNCiAgICAgKiAgICAgICAgIC8vDQogICAgICogICAgICAgICAvL2lzRW5hYmxlZDogQm9vbGVhbg0KICAgICAqICAgICAgICAgLy8NCiAgICAgKiAgICAgICAgIC8vIFNldHMgd2hldGhlciB0aGUgbmF2aWdhdGlvbiBpcyBlbmFibGVkLg0KICAgICAqICAgICAgICAgLy8NCiAgICAgKiAgICAgICAgICdpc0VuYWJsZWQnOiB0cnVlLA0KICAgICAqICAgICAgICAgLy8NCiAgICAgKiAgICAgICAgIC8vIGhhc1ByZXZOZXh0SXRlbXM6IEJvb2xlYW4NCiAgICAgKiAgICAgICAgIC8vDQogICAgICogICAgICAgICAvLyBTZXRzIHdoZXRoZXIgdGhlIG5hdmlnYXRpb24gaGFzIHByZXZpb3VzIGFuZCBuZXh0IGJ1dHRvbnMuDQogICAgICogICAgICAgICAvLw0KICAgICAqICAgICAgICAgJ2hhc1ByZXZOZXh0SXRlbXMnOiB0cnVlLA0KICAgICAqICAgICAgICAgLy8NCiAgICAgKiAgICAgICAgIC8vIGl0ZW06IE9iamVjdA0KICAgICAqICAgICAgICAgLy8NCiAgICAgKiAgICAgICAgIC8vIE5hdmlnYXRpb24gaXRlbSBjb25maWd1cmF0aW9uIG9iamVjdC4NCiAgICAgKiAgICAgICAgIC8vDQogICAgICogICAgICAgICAnaXRlbSc6IHsNCiAgICAgKiAgICAgICAgICAgICAvLw0KICAgICAqICAgICAgICAgICAgIC8vIGxhYmVsOiBTdHJpbmcNCiAgICAgKiAgICAgICAgICAgICAvLw0KICAgICAqICAgICAgICAgICAgIC8vIExhYmVsIHRlbXBsYXRlOyBlYWNoICcje2luZGV4fScgc3RyaW5nIHdpbGwgYmUgcmVwbGFjZWQgYnkgdGhlIG51bWJlciBvZiBhIHNsaWRlLg0KICAgICAqICAgICAgICAgICAgIC8vDQogICAgICogICAgICAgICAgICAgJ2xhYmVsJzogJyN7aW5kZXh9JywNCiAgICAgKiAgICAgICAgICAgICAvLw0KICAgICAqICAgICAgICAgICAgIC8vIHNlbGVjdG9yOiBTdHJpbmcNCiAgICAgKiAgICAgICAgICAgICAvLw0KICAgICAqICAgICAgICAgICAgIC8vIE5hdmlnYXRpb24gaXRlbXMgY29udGFpbmVyIHNlbGVjdG9yOyBpZiBlcXVhbHMgbnVsbCwgdGhlIGNvbnRhaW5lciB3aWxsIGJlIGdlbmVyYXRlZA0KICAgICAqICAgICAgICAgICAgIC8vICgnZGl2JyBlbGVtZW50IHdpdGggJ25hdicgY2xhc3MgYXR0cmlidXRlIGluc2lkZSB0aGUgY2Fyb3VzZWwpLg0KICAgICAqICAgICAgICAgICAgIC8vDQogICAgICogICAgICAgICAgICAgJ3NlbGVjdG9yJzogbnVsbA0KICAgICAqICAgICAgICB9LA0KICAgICAqICAgICAgICAgLy8NCiAgICAgKiAgICAgICAgIC8vIHByZXZJdGVtOiBPYmplY3QNCiAgICAgKiAgICAgICAgIC8vDQogICAgICogICAgICAgICAvLyBOYXZpZ2F0aW9uICdwcmV2aW91cyBpdGVtJyBjb25maWd1cmF0aW9uIG9iamVjdC4NCiAgICAgKiAgICAgICAgIC8vDQogICAgICogICAgICAgICAncHJldkl0ZW0nOiB7DQogICAgICogICAgICAgICAgICAgLy8NCiAgICAgKiAgICAgICAgICAgICAvLyBsYWJlbDogU3RyaW5nDQogICAgICogICAgICAgICAgICAgLy8NCiAgICAgKiAgICAgICAgICAgICAvLyBUaGUgJ3ByZXZpb3VzIGl0ZW0nIGxhYmVsLg0KICAgICAqICAgICAgICAgICAgIC8vDQogICAgICogICAgICAgICAgICAgJ2xhYmVsJzogJzwnLA0KICAgICAqICAgICAgICAgICAgIC8vDQogICAgICogICAgICAgICAgICAgLy8gc2VsZWN0b3I6IFN0cmluZw0KICAgICAqICAgICAgICAgICAgIC8vDQogICAgICogICAgICAgICAgICAgLy8gTmF2aWdhdGlvbiAncHJldmlvdXMgaXRlbScgc2VsZWN0b3I7IGlmIGVxdWFscyBudWxsLCB0aGUgaXRlbSB3aWxsIGJlIGdlbmVyYXRlZA0KICAgICAqICAgICAgICAgICAgIC8vICgnYScgZWxlbWVudCB3aXRoICdwcmV2JyBjbGFzcyBhdHRyaWJ1dGUgaW5zaWRlIHRoZSBuYXZpZ2F0aW9uIGNvbnRhaW5lcikuDQogICAgICogICAgICAgICAgICAgLy8NCiAgICAgKiAgICAgICAgICAgICAnc2VsZWN0b3InOiBudWxsLA0KICAgICAqICAgICAgICAgICAgIC8vDQogICAgICogICAgICAgICAgICAgLy8gaXNDb250YWluZXI6IEJvb2xlYW4NCiAgICAgKiAgICAgICAgICAgICAvLw0KICAgICAqICAgICAgICAgICAgIC8vIFNldHMgd2hldGhlciB0aGUgZWxlbWVudCBmb3VuZCBieSBzZWxlY3RvciBzaG91bGQgYmUgdHJlYXRlZCBhcyBhIGNvbnRhaW5lciAoaWYgdHJ1ZSkNCiAgICAgKiAgICAgICAgICAgICAvLyBvciBzaG91bGQgYmUgYWRvcHRlZCBhcyBhICdwcmV2aW91cyBpdGVtJyAoaWYgZmFsc2UpLiBJZiBzZWxlY3RvciBlcXVhbHMgbnVsbCB0aGlzIHByb3BlcnR5IGlzIG1lYW5pbmdsZXNzLg0KICAgICAqICAgICAgICAgICAgIC8vDQogICAgICogICAgICAgICAgICAgJ2lzQ29udGFpbmVyJzogZmFsc2UNCiAgICAgKiAgICAgICAgIH0sDQogICAgICogICAgICAgICAvLw0KICAgICAqICAgICAgICAgLy8gbmV4dEl0ZW06IE9iamVjdA0KICAgICAqICAgICAgICAgLy8NCiAgICAgKiAgICAgICAgIC8vIE5hdmlnYXRpb24gJ25leHQgaXRlbScgY29uZmlndXJhdGlvbiBvYmplY3QuDQogICAgICogICAgICAgICAvLw0KICAgICAqICAgICAgICAgJ25leHRJdGVtJzogew0KICAgICAqICAgICAgICAgICAgIC8vDQogICAgICogICAgICAgICAgICAgLy8gbGFiZWw6IFN0cmluZw0KICAgICAqICAgICAgICAgICAgIC8vDQogICAgICogICAgICAgICAgICAgLy8gVGhlICduZXh0IGl0ZW0nIGxhYmVsLg0KICAgICAqICAgICAgICAgICAgIC8vDQogICAgICogICAgICAgICAgICAgJ2xhYmVsJzogJz4nLA0KICAgICAqICAgICAgICAgICAgIC8vDQogICAgICogICAgICAgICAgICAgLy8gc2VsZWN0b3I6IFN0cmluZw0KICAgICAqICAgICAgICAgICAgIC8vDQogICAgICogICAgICAgICAgICAgLy8gTmF2aWdhdGlvbiAnbmV4dCBpdGVtJyBzZWxlY3RvcjsgaWYgZXF1YWxzIG51bGwsIHRoZSBpdGVtIHdpbGwgYmUgZ2VuZXJhdGVkDQogICAgICogICAgICAgICAgICAgLy8gKCdhJyBlbGVtZW50IHdpdGggJ25leHQnIGNsYXNzIGF0dHJpYnV0ZSBpbnNpZGUgdGhlIG5hdmlnYXRpb24gY29udGFpbmVyKS4NCiAgICAgKiAgICAgICAgICAgICAvLw0KICAgICAqICAgICAgICAgICAgICdzZWxlY3Rvcic6IG51bGwsDQogICAgICogICAgICAgICAgICAgLy8NCiAgICAgKiAgICAgICAgICAgICAvLyBpc0NvbnRhaW5lcjogQm9vbGVhbg0KICAgICAqICAgICAgICAgICAgIC8vDQogICAgICogICAgICAgICAgICAgLy8gU2V0cyB3aGV0aGVyIHRoZSBlbGVtZW50IGZvdW5kIGJ5IHNlbGVjdG9yIHNob3VsZCBiZSB0cmVhdGVkIGFzIGEgY29udGFpbmVyIChpZiB0cnVlKQ0KICAgICAqICAgICAgICAgICAgIC8vIG9yIHNob3VsZCBiZSBhZG9wdGVkIGFzIGEgJ25leHQgaXRlbScgKGlmIGZhbHNlKS4gSWYgc2VsZWN0b3IgZXF1YWxzIG51bGwgdGhpcyBwcm9wZXJ0eSBpcyBtZWFuaW5nbGVzcy4NCiAgICAgKiAgICAgICAgICAgICAvLw0KICAgICAqICAgICAgICAgICAgICdpc0NvbnRhaW5lcic6IGZhbHNlDQogICAgICogICAgICAgICB9DQogICAgICogICAgIH0sDQogICAgICogICAgIC8vDQogICAgICogICAgIC8vIHRpbWVvdXQ6IE51bWJlcg0KICAgICAqICAgICAvLw0KICAgICAqICAgICAvLyBUaGUgaW50ZXJ2YWwgYmV0d2VlbiB0aGUgc2xpZGVzIGluIG1pbGlzZWNvbmRzLg0KICAgICAqICAgICAvLw0KICAgICAqICAgICAndGltZW91dCc6IDEwMDAwLA0KICAgICAqICAgICAvLw0KICAgICAqICAgICAvLyB0cmFuc2l0aW9uOiBTdHJpbmcNCiAgICAgKiAgICAgLy8NCiAgICAgKiAgICAgLy8gTmFtZSBvZiB0aGUgdHJhbnNpdGlvbiBjbGFzcywgd2hpY2ggd2lsbCBiZSB1c2VkLiBQb3NzaWJsZSB2YWx1ZXMgYXJlOg0KICAgICAqICAgICAvLyAtIEJhc2ljVHJhbnNpdGlvbiAtIHdpdGhvdXQgYW55IGFuaW1hdGlvbiwNCiAgICAgKiAgICAgLy8gLSBGYWRlSW5UcmFuc2l0aW9uIC0gbmV3IHNsaWRlIGZhZGVzIGluLA0KICAgICAqICAgICAvLyAtIFNsaWRlSG9yaXpvbnRhbGx5VHJhbnNpdGlvbiAtIG5ldyBzbGlkZSBtb3ZlcyBmcm9tIHJpZ2h0IChmcm9tIGxlZnQgaWYgdXNlciBzZWxlY3RzIHNsaWRlIHdpdGggbG93ZXIgaWQgb3IgY2xpY2tzIG9uICdwcmV2aW91cyBpdGVtJyksDQogICAgICogICAgIC8vIC0gU2xpZGVWZXJ0aWNhbGx5VHJhbnNpdGlvbiAtIG5ldyBzbGlkZSBtb3ZlcyBmcm9tIHRvcCAoZnJvbSBib3R0b20gaWYgdXNlciBzZWxlY3RzIHNsaWRlIHdpdGggbG93ZXIgaWQgb3IgY2xpY2tzIG9uICdwcmV2aW91cyBpdGVtJyksDQogICAgICogICAgIC8vIC0gb3RoZXIgLSBpZiBpbXBsZW1lbnRlZCAoZGVyaXZlZCBmcm9tIFhBLmNvbXBvbmVudC5jYXJvdXNlbHMuVHJhbnNpdGlvbnMuVHJhbnNpdGlvbiBjbGFzcykgYW5kIGFkZGVkIHRvIFhBLmNvbXBvbmVudC5jYXJvdXNlbHMuVHJhbnNpdGlvbnMgbW9kdWxlLg0KICAgICAqICAgICAvLw0KICAgICAqICAgICAndHJhbnNpdGlvbic6ICdCYXNpY1RyYW5zaXRpb24nLA0KICAgICAqICAgICAvLw0KICAgICAqICAgICAvLyBpc1BhdXNlRW5hYmxlZDogQm9vbGVhbg0KICAgICAqICAgICAvLw0KICAgICAqICAgICAvLyBTZXRzIHdoZXRoZXIgdGhlIHBhdXNlIGZlYXR1cmUgaXMgZW5hYmxlZC4NCiAgICAgKiAgICAgLy8gUGF1c2UgZmVhdHVyZSBwYXVzZXMgY291bnRkb3duIG9mIGNoYW5naW5nIHNsaWRlcywgd2hlbiBtb3VzZSBpcyBpbiBhIGNhcm91c2VsIGFyZWEuDQogICAgICogICAgIC8vDQogICAgICogICAgICdpc1BhdXNlRW5hYmxlZCc6IHRydWUsDQogICAgICogICAgIC8vDQogICAgICogICAgIC8vIHRpbWVJbmRpY2F0b3I6IE9iamVjdA0KICAgICAqICAgICAvLw0KICAgICAqICAgICAvLyAnVGltZSBpbmRpY2F0b3InIGNvbmZpZ3VyYXRpb24gb2JqZWN0Lg0KICAgICAqICAgICAvLw0KICAgICAqICAgICAndGltZUluZGljYXRvcic6IHsNCiAgICAgKiAgICAgICAgIC8vDQogICAgICogICAgICAgICAvLyBpc0VuYWJsZWQ6IEJvb2xlYW4NCiAgICAgKiAgICAgICAgIC8vDQogICAgICogICAgICAgICAvLyBTZXRzIHdoZXRoZXIgdGhlICd0aW1lIGluZGljYXRvcicgaXMgZW5hYmxlZC4NCiAgICAgKiAgICAgICAgIC8vDQogICAgICogICAgICAgICAnaXNFbmFibGVkJzogZmFsc2UsDQogICAgICogICAgICAgICAvLw0KICAgICAqICAgICAgICAgLy8gc2VsZWN0b3I6IFN0cmluZw0KICAgICAqICAgICAgICAgLy8NCiAgICAgKiAgICAgICAgIC8vICdUaW1lIGluZGljYXRvcicgc2VsZWN0b3IuDQogICAgICogICAgICAgICAvLw0KICAgICAqICAgICAgICAgJ3NlbGVjdG9yJzogbnVsbCwNCiAgICAgKiAgICAgICAgIC8vDQogICAgICogICAgICAgICAvLyB2aWV3OiBTdHJpbmcNCiAgICAgKiAgICAgICAgIC8vDQogICAgICogICAgICAgICAvLyBOYW1lIG9mIHRoZSB2aWV3IGNsYXNzLCB3aGljaCB3aWxsIGJlIHVzZWQuIFBvc3NpYmxlIHZhbHVlcyBhcmU6DQogICAgICogICAgICAgICAvLyAtIFZpZXcgLSB3aXRob3V0IGFueSBhbmltYXRpb24gKGJhc2UgY2xhc3MpLA0KICAgICAqICAgICAgICAgLy8gLSBQcm9ncmVzc0JhclZpZXcgLSBzaG93cyB0aGUgcHJvZ3Jlc3Mgb2YgdGltZSBhcyBwcm9ncmVzcyBiYXIsDQogICAgICogICAgICAgICAvLyAtIFJvdGF0b3JWaWV3IC0gc2hvd3MgdGhlIHByb2dyZXNzIG9mIHRpbWUgd2l0aCB0aGUgZmlsbGluZyB1cCByaW5nDQogICAgICogICAgICAgICAvLyAtIG90aGVyIC0gaWYgaW1wbGVtZW50ZWQgKGRlcml2ZWQgZnJvbSBYQS5jb21wb25lbnQuY2Fyb3VzZWxzLkluZGljYXRvclZpZXdzLlZpZXcgY2xhc3MpIGFuZCBhZGRlZCB0byBYQS5jb21wb25lbnQuY2Fyb3VzZWxzLkluZGljYXRvclZpZXdzIG1vZHVsZS4NCiAgICAgKiAgICAgICAgIC8vDQogICAgICogICAgICAgICAndmlldyc6ICdWaWV3JywNCiAgICAgKiAgICAgICAgIC8vDQogICAgICogICAgICAgICAvLyBvcHRpb25zOiBPYmplY3QNCiAgICAgKiAgICAgICAgIC8vDQogICAgICogICAgICAgICAvLyAnVGltZSBpbmRpY2F0b3InIHZpZXcgc2V0dGluZ3Mgb2JqZWN0LiBEZXBlbmRzIG9uIHZpZXcuDQogICAgICogICAgICAgICAvLw0KICAgICAqICAgICAgICAgJ29wdGlvbnMnOiB7fQ0KICAgICAqICAgICB9DQogICAgICogfQ0KICAgICAqLw0KDQogICAgLyogcHViLnJlZ2lzdGVyID0gZnVuY3Rpb24gKHNlbGVjdG9yLCBvcHRpb25zKSB7DQogICAgIHZhciAkY2Fyb3VzZWxzID0gJChzZWxlY3Rvcik7DQogICAgICRjYXJvdXNlbHMuZWFjaChmdW5jdGlvbiAoKSB7DQogICAgIC8vdmFyIGNhcm91c2VsID0gbmV3IENhcm91c2VsKCQpOw0KICAgICBjb25zb2xlLmxvZygkKHRoaXMpKTsNCiAgICAgLy9jYXJvdXNlbC5pbml0KCQodGhpcyksIG9wdGlvbnMpOw0KICAgICB9KTsNCiAgICAgfTsqLw0KDQogICAgQ2Fyb3VzZWwucHJvdG90eXBlLmFkZFJlc3BvbnNpdmUgPSBmdW5jdGlvbihjYXJvdXNlbCkgew0KICAgICAgICBmdW5jdGlvbiBzZXRDYXJvdXNlbFNpemUoKSB7DQogICAgICAgICAgICBjYXJvdXNlbC5jc3MoIndpZHRoIiwgIjEwMCUiKTsNCiAgICAgICAgICAgIGNhcm91c2VsLmNzcygiaGVpZ2h0IiwgImF1dG8iKTsNCiAgICAgICAgICAgIGNhcm91c2VsLmZpbmQoIi53cmFwcGVyICwgLnNsaWRlIikuY3NzKCJoZWlnaHQiLCAiYXV0byIpOw0KDQogICAgICAgICAgICB2YXIgY2Fyb3VzZWxXaWR0aCA9IGNhcm91c2VsLndpZHRoKCksDQogICAgICAgICAgICAgICAgc2xpZGVzID0gY2Fyb3VzZWwuZmluZCgnLnNsaWRlJyksDQogICAgICAgICAgICAgICAgc2xpZGVNYXhIZWlnaHQgPSAwOw0KDQoNCiAgICAgICAgICAgIF8uZWFjaChzbGlkZXMsIGZ1bmN0aW9uKGl0ZW0pIHsNCiAgICAgICAgICAgICAgICB2YXIgc2xpZGVIZWlnaHQgPSAkKGl0ZW0pLm91dGVySGVpZ2h0KCk7DQoNCiAgICAgICAgICAgICAgICBpZiAoc2xpZGVNYXhIZWlnaHQgPCBzbGlkZUhlaWdodCkgew0KICAgICAgICAgICAgICAgICAgICBzbGlkZU1heEhlaWdodCA9IHNsaWRlSGVpZ2h0Ow0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0pOw0KDQogICAgICAgICAgICBjYXJvdXNlbC5maW5kKCIuc2xpZGUsIC5zbGlkZXMiKS5jc3MoIndpZHRoIiwgY2Fyb3VzZWxXaWR0aCk7DQogICAgICAgICAgICBjYXJvdXNlbC5maW5kKCIud3JhcHBlciIpLmNzcygiaGVpZ2h0Iiwgc2xpZGVNYXhIZWlnaHQpOw0KICAgICAgICAgICAgY2Fyb3VzZWwuZmluZCgiLnNsaWRlIikuY3NzKCJoZWlnaHQiLCBzbGlkZU1heEhlaWdodCk7DQogICAgICAgIH0NCg0KICAgICAgICBzZXRDYXJvdXNlbFNpemUoKTsNCiAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3Jlc2l6ZScsIGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgc2V0Q2Fyb3VzZWxTaXplKCk7DQogICAgICAgIH0pOw0KICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignbG9hZCcsIGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgc2V0Q2Fyb3VzZWxTaXplKCk7DQoJCQljYXJvdXNlbC5hZGRDbGFzcygiY2Fyb3VzZWwtcmVhZHkiKTsNCiAgICAgICAgfSk7DQogICAgfTsNCg0KICAgIC8qIENhcm91c2VsIHRvdWNoIHN1cHBvcnQgKi8NCiAgICBDYXJvdXNlbC5wcm90b3R5cGUuc3dpcGVTbGlkZSA9IGZ1bmN0aW9uIChlKSB7DQogICAgICAgIHZhciBzZWxmID0gdGhpcywNCiAgICAgICAgICAgICR3cmFwcGVyID0gdGhpcy5zbGlkZXIuY29udGV4dC4kd3JhcHBlciwNCiAgICAgICAgICAgIGhhbW1lciA9IG5ldyBIYW1tZXIoJHdyYXBwZXJbMF0pOw0KDQogICAgICAgIGhhbW1lci5vbigic3dpcGVsZWZ0IiwgZnVuY3Rpb24oZSkgew0KICAgICAgICAgICAgc2VsZi5zbGlkZXIuY29udGV4dC5vd25lci5vbkNoYW5nZUN1cnJlbnRTbGlkZShlLCAxLCBzZWxmLnNsaWRlci5jb250ZXh0KTsNCiAgICAgICAgfSk7DQoNCiAgICAgICAgaGFtbWVyLm9uKCJzd2lwZXJpZ2h0IiwgZnVuY3Rpb24oZSkgew0KICAgICAgICAgICAgc2VsZi5zbGlkZXIuY29udGV4dC5vd25lci5vbkNoYW5nZUN1cnJlbnRTbGlkZShlLCAtMSwgc2VsZi5zbGlkZXIuY29udGV4dCk7DQogICAgICAgIH0pOw0KICAgIH07DQoNCiAgICBDYXJvdXNlbC5wcm90b3R5cGUuY2hlY2tGb3JEaXNhYmxlciA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgdmFyIHNsaWRlcyA9IHRoaXMuJHNsaWRlczsNCiAgICAgICAgJHdyYXBwZXIgPSB0aGlzLnNsaWRlci5jb250ZXh0LiR3cmFwcGVyOw0KICAgICAgICBfLmVhY2goc2xpZGVzLCBmdW5jdGlvbihpdGVtKSB7DQogICAgICAgICAgICB2YXIgJGl0ZW0gPSAkKGl0ZW0pLA0KICAgICAgICAgICAgICAgIGNwZGlzYWJsZWQgPSAkaXRlbS5maW5kKCcuY3BkaXNhYmxlcicpLA0KICAgICAgICAgICAgICAgICRpdGVtQm9yZGVyID0gcGFyc2VJbnQoJChpdGVtKS5jc3MoJ2JvcmRlcicpLCAxMCkgPyBwYXJzZUludCgkKGl0ZW0pLmNzcygnYm9yZGVyJyksIDEwKSAgOiAxMDsNCg0KICAgICAgICAgICAgaWYgKGNwZGlzYWJsZWQuc2libGluZ3MoJy5jb21wb25lbnQnKS5sZW5ndGggPCAxKSB7DQogICAgICAgICAgICAgICAgJHdyYXBwZXIuY3NzKHsNCiAgICAgICAgICAgICAgICAgICAgJ21pbi1oZWlnaHQnIDogMjUNCiAgICAgICAgICAgICAgICB9KQ0KICAgICAgICAgICAgICAgIGNwZGlzYWJsZWQudGV4dCgiRWRpdCBlbGVtZW50IGhlcmUiKTsNCiAgICAgICAgICAgICAgICBjcGRpc2FibGVkLnBhcmVudCgpLmNzcyh7DQogICAgICAgICAgICAgICAgICAgICd3aWR0aCcgOiAkaXRlbS53aWR0aCgpIC0gJGl0ZW1Cb3JkZXIsDQogICAgICAgICAgICAgICAgICAgICdtaW4taGVpZ2h0JyA6IDI1LA0KICAgICAgICAgICAgICAgICAgICAnaGVpZ2h0JyA6ICRpdGVtLmhlaWdodCgpDQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0pOw0KICAgIH0NCg0KDQogICAgQ2Fyb3VzZWwucHJvdG90eXBlLnJlc2l6ZVdyYXBwZXIgPSBmdW5jdGlvbigpIHsNCiAgICAgICAgdmFyIHBhZ2VIZWlnaHQgPSAkKGRvY3VtZW50KS5vdXRlckhlaWdodCgpLA0KICAgICAgICAgICAgaGVhZGVySGVpZ2h0ID0gJCgnI2hlYWRlcicpLm91dGVySGVpZ2h0KCksDQogICAgICAgICAgICBjb250ZW50UGFkZGluZ1RvcCA9IHBhcnNlSW50KCQoJyNjb250ZW50JykuY3NzKCdwYWRkaW5nLXRvcCcpLCAxMCksDQogICAgICAgICAgICBjb250ZW50UGFkZGluZ0JvdHRvbSA9IHBhcnNlSW50KCQoJyNjb250ZW50JykuY3NzKCdwYWRkaW5nLWJvdHRvbScpLCAxMCksDQogICAgICAgICAgICBjb250ZW50UGFkZGluZyA9IGNvbnRlbnRQYWRkaW5nVG9wICsgY29udGVudFBhZGRpbmdCb3R0b20sDQogICAgICAgICAgICBmb290ZXJIZWlnaHQgPSAkKCcjZm9vdGVyJykub3V0ZXJIZWlnaHQoKSwNCiAgICAgICAgICAgIHdyYXBwZXIgPSB0aGlzLnNsaWRlci5jb250ZXh0LiR3cmFwcGVyLA0KICAgICAgICAgICAgY2Fyb3VzZWxIZWlnaHQgPSAwOw0KDQogICAgICAgIGNhcm91c2VsSGVpZ2h0ID0gcGFnZUhlaWdodCAtIChoZWFkZXJIZWlnaHQgKyBmb290ZXJIZWlnaHQgKyBjb250ZW50UGFkZGluZyk7DQoNCiAgICAgICAgd3JhcHBlci5jc3Moew0KICAgICAgICAgICAgJ2hlaWdodCc6IGNhcm91c2VsSGVpZ2h0DQogICAgICAgIH0pOw0KDQogICAgICAgIHdyYXBwZXIuZmluZCgnLnNsaWRlcycpLmNzcyh7DQogICAgICAgICAgICAnaGVpZ2h0JzogY2Fyb3VzZWxIZWlnaHQNCiAgICAgICAgfSk7DQogICAgfTsNCg0KDQoNCiAgICBwdWIuaW5pdCA9IGZ1bmN0aW9uKCkgew0KICAgICAgICAkKCIuY2Fyb3VzZWw6bm90KC5pbml0aWFsaXplZCkiKS5lYWNoKGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgdmFyIHByb3BlcnRpZXMgPSAkKHRoaXMpLmRhdGEoInByb3BlcnRpZXMiKSwNCiAgICAgICAgICAgICAgICBjb21wb25lbnQgPSAkKHRoaXMpLmZpbmQoIi5jYXJvdXNlbC1pbm5lciIpLA0KICAgICAgICAgICAgICAgIGlkID0gY29tcG9uZW50LmF0dHIoImlkIik7DQoNCiAgICAgICAgICAgIGlmIChwcm9wZXJ0aWVzKSB7DQogICAgICAgICAgICAgICAgcHJvcGVydGllcy5uYXZpZ2F0aW9uLml0ZW0uc2VsZWN0b3IgPSAiIyIgKyBwcm9wZXJ0aWVzLm5hdmlnYXRpb24uaXRlbS5zZWxlY3RvcjsNCiAgICAgICAgICAgICAgICBwcm9wZXJ0aWVzLm5hdmlnYXRpb24ucHJldkl0ZW0uc2VsZWN0b3IgPSAiIyIgKyBpZCArICIgLm5hdiI7DQogICAgICAgICAgICAgICAgcHJvcGVydGllcy5uYXZpZ2F0aW9uLm5leHRJdGVtLnNlbGVjdG9yID0gIiMiICsgaWQgKyAiIC5uYXYiOw0KDQogICAgICAgICAgICAgICAgdmFyIGNhcm91c2VsID0gbmV3IENhcm91c2VsKCQpOw0KICAgICAgICAgICAgICAgIGNhcm91c2VsLmluaXQoY29tcG9uZW50LCBwcm9wZXJ0aWVzKTsNCiAgICAgICAgICAgICAgICBjYXJvdXNlbC5hZGRSZXNwb25zaXZlKCQodGhpcykpOw0KDQogICAgICAgICAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2xvYWQnLCBmdW5jdGlvbihlKSB7DQogICAgICAgICAgICAgICAgICAgIGlmKCQoc2VsZikuaGFzQ2xhc3MoJ2Nhcm91c2VsLWNsaWVudHMnKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgY2Fyb3VzZWwucmVzaXplV3JhcHBlcigpOw0KICAgICAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICAgICAgY2Fyb3VzZWwuY2hlY2tGb3JEaXNhYmxlcigpOw0KICAgICAgICAgICAgICAgIH0pOw0KDQogICAgICAgICAgICAgICAgY2Fyb3VzZWwuc3dpcGVTbGlkZSgpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAkKHRoaXMpLmFkZENsYXNzKCJpbml0aWFsaXplZCIpOw0KICAgICAgICB9KTsNCiAgICB9Ow0KDQogICAgcmV0dXJuIHB1YjsNCn0oalF1ZXJ5KSk7DQovKioNCiAqIGVuZCBvZiBYQS5jb21wb25lbnQuY2Fyb3VzZWxzIG1vZHVsZS4NCiAqLw0KDQoNClhBLnJlZ2lzdGVyKCJjYXJvdXNlbHMiLCBYQS5jb21wb25lbnQuY2Fyb3VzZWxzKTsNCg0KDQovKioNCiAqIENvZ25pZmlkZQ0KICoNCiAqIFhBLmNvbXBvbmVudC5jYXJvdXNlbHMuVHJhbnNpdGlvbnMgbW9kdWxlLg0KICoNCiAqIEV4cG9zZXMgVHJhbnNpdGlvbiBjbGFzcywgd2hpY2ggaXMgYmFzZSBjbGFzcyBvZiBhbGwgdHJhbnNpdGlvbnMgdXNlZCBieSBjYXJvdXNlbHMgKEBzZWUgWEEuY29tcG9uZW50LmNhcm91c2VscywgQHNlZSBTbGlkZXIsIEBzZWUgVHJhbnNpdGlvbikuDQogKiBBbHNvIGV4cG9zZXMgaW1wbGVtZW50YXRpb24gb2YgYmFzaWMgZWZmZWN0czoNCiAqIC0gQmFzaWNUcmFuc2l0aW9uIC0gd2l0aG91dCBhbnkgYW5pbWF0aW9uLA0KICogLSBGYWRlSW5UcmFuc2l0aW9uIC0gbmV3IHNsaWRlIGZhZGVzIGluLA0KICogLSBTbGlkZUhvcml6b250YWxseVRyYW5zaXRpb24gLSBuZXcgc2xpZGUgbW92ZXMgZnJvbSByaWdodCAoZnJvbSBsZWZ0IGlmIHVzZXIgc2VsZWN0cyBzbGlkZSB3aXRoIGxvd2VyIGlkIG9yIGNsaWNrcyBvbiAncHJldmlvdXMgaXRlbScpLA0KICogLSBTbGlkZVZlcnRpY2FsbHlUcmFuc2l0aW9uIC0gbmV3IHNsaWRlIG1vdmVzIGZyb20gdG9wIChmcm9tIGJvdHRvbSBpZiB1c2VyIHNlbGVjdHMgc2xpZGUgd2l0aCBsb3dlciBpZCBvciBjbGlja3Mgb24gJ3ByZXZpb3VzIGl0ZW0nKS4NCiAqIENhcm91c2VsIHRha2VzIHRoZSBjbGFzcyBjb25zdHJ1Y3RvciBieSBuYW1lIGZyb20gdGhpcyBtb2R1bGUgKGl0IGlzIGdpdmVuIGluIG9wdGlvbnMgb2JqZWN0IG9mIGNhcm91c2VsOyBAc2VlIFhBLmNvbXBvbmVudC5jYXJvdXNlbHMpLg0KICogSWYgdGhlcmUgaXMgYSBuZWVkIHRvIGltcGxlbWVudCB0aGUgbmV3IGVmZmVjdCwgY3JlYXRlIGEgbmV3IGNsYXNzLCBieSBpbmhlcml0aW5nIGZyb20gVHJhbnNpdGlvbiBjbGFzcyBhbmQgYWRkIGl0IHRvIHRoaXMgbW9kdWxlLg0KICoNCiAqIEV4YW1wbGUgZWZmZWN0IGltcGxlbWVudGF0aW9uIChjdXJyZW50bHkgZGlzcGxheWVkIHNsaWRlIGlzIHNocmlua2luZyB0byBjZW50ZXIgb2YgdGhlIGNhcm91c2VsKToNCiAqIChmdW5jdGlvbiAoKSB7DQoqICAgICBmdW5jdGlvbiBTYW1wbGVUcmFuc2l0aW9uKCkgeyB9DQoqDQoqICAgICAvL2luaGVyaXQgZnJvbSBYQS5jb21wb25lbnQuY2Fyb3VzZWxzLlRyYW5zaXRpb25zLlRyYW5zaXRpb24NCiogICAgIFNhbXBsZVRyYW5zaXRpb24ucHJvdG90eXBlID0gbmV3IFhBLmNvbXBvbmVudC5jYXJvdXNlbHMuVHJhbnNpdGlvbnMuVHJhbnNpdGlvbigpOw0KKiAgICAgU2FtcGxlVHJhbnNpdGlvbi5jb25zdHJ1Y3RvciA9IFNhbXBsZVRyYW5zaXRpb247DQoqDQoqICAgICBTYW1wbGVUcmFuc2l0aW9uLnByb3RvdHlwZS5pbml0ID0gZnVuY3Rpb24gKHNldHRpbmdzKSB7DQoqICAgICAgICAgLy9wb3NpdGlvbmluZyBhbGwgc2xpZGVzIGluIHRoZSB0b3AgbGVmdCBjb3JuZXIgb2YgdGhlIGNhcm91c2VsDQoqICAgICAgICAgc2V0dGluZ3MuJHNsaWRlcy5jc3Moew0KKiAgICAgICAgICAgICAncG9zaXRpb24nOiAnYWJzb2x1dGUnLA0KKiAgICAgICAgICAgICAndG9wJzogJzBweCcsDQoqICAgICAgICAgICAgICdsZWZ0JzogJzBweCcNCiogICAgICAgICB9KTsNCiogICAgIH07DQoqDQoqICAgICBTYW1wbGVUcmFuc2l0aW9uLnByb3RvdHlwZS5vbkFuaW1hdGlvbkNvbXBsZXRlID0gZnVuY3Rpb24oc2V0dGluZ3MsIHdpZHRoLCBoZWlnaHQpIHsNCiogICAgICAgICB2YXIgekluZGV4QXR0cmliID0gJ3otaW5kZXgnLA0KKiAgICAgICAgICRjdXJyZW50ID0gc2V0dGluZ3MuJGN1cnJlbnRTbGlkZTsNCioNCiogICAgICAgICAkY3VycmVudC5oaWRlKCk7DQogICAgICAgICAgLy9yZXZlcnRpbmcgY2hhbmdlcyBpbiBjc3MgcHJvcGVydGllcw0KKiAgICAgICAgICRjdXJyZW50LmNzcyh7DQoqICAgICAgICAgICAgICd3aWR0aCc6IHdpZHRoLA0KKiAgICAgICAgICAgICAnaGVpZ2h0JzogaGVpZ2h0LA0KKiAgICAgICAgICAgICAnbGVmdCc6IDAsDQoqICAgICAgICAgICAgICd0b3AnOiAwDQoqICAgICAgICAgfSk7DQoqICAgICAgICAgJGN1cnJlbnQuY3NzKHpJbmRleEF0dHJpYiwgJycpOw0KKiAgICAgICAgIHNldHRpbmdzLiRzbGlkZXMucGFyZW50KCkuY3NzKHpJbmRleEF0dHJpYiwgJycpOw0KKg0KKiAgICAgICAgIC8vbm90aWZ5aW5nIHRoZSBjYXJvdXNlbCwgdGhhdCBhbmltYXRpb24gaXMgY29tcGxldGVkDQoqICAgICAgICAgc2V0dGluZ3MuY2FsbGJhY2soKTsNCiogICAgIH07DQoqDQoqICAgICBTYW1wbGVUcmFuc2l0aW9uLnByb3RvdHlwZS5wZXJmb3JtID0gZnVuY3Rpb24gKHNldHRpbmdzKSB7DQoqICAgICAgICAgdmFyIGhlaWdodCA9IHNldHRpbmdzLiRjdXJyZW50U2xpZGUuaGVpZ2h0KCksDQoqICAgICAgICAgd2lkdGggPSBzZXR0aW5ncy4kY3VycmVudFNsaWRlLndpZHRoKCksDQoqICAgICAgICAgb25BbmltYXRpb25Db21wbGV0ZWQgPSB0aGlzLm9uQW5pbWF0aW9uQ29tcGxldGUsDQoqICAgICAgICAgekluZGV4QXR0cmliID0gJ3otaW5kZXgnLA0KKiAgICAgICAgICRwYXJlbnQgPSBzZXR0aW5ncy4kc2xpZGVzLnBhcmVudCgpLA0KKiAgICAgICAgICRjdXJyZW50ID0gc2V0dGluZ3MuJGN1cnJlbnRTbGlkZSwNCiogICAgICAgICAkbmV4dCA9IHNldHRpbmdzLiRuZXh0U2xpZGU7DQoqDQoqICAgICAgICAgLy9zZXR0aW5nIGEgbmV3IHNsaWRlIHVuZGVyIHRoZSBjdXJyZW50IHNsaWRlDQoqICAgICAgICAgJHBhcmVudC5jc3MoekluZGV4QXR0cmliLCAwKTsNCiogICAgICAgICAkY3VycmVudC5jc3MoekluZGV4QXR0cmliLCAxKTsNCiogICAgICAgICAkbmV4dC5zaG93KCk7DQoqDQoqICAgICAgICAgLy9hbmltYXRlIGN1cnJlbnQgc2xpZGUNCiogICAgICAgICAkY3VycmVudC5hbmltYXRlKHsNCiogICAgICAgICAgICAgJ3dpZHRoJzogJzBweCcsDQoqICAgICAgICAgICAgICdoZWlnaHQnOiAnMHB4JywNCiogICAgICAgICAgICAgJ2xlZnQnOiB3aWR0aCAvIDIsDQoqICAgICAgICAgICAgICd0b3AnOiBoZWlnaHQgLyAyDQoqICAgICAgICAgfSwgZnVuY3Rpb24oKSB7DQoqICAgICAgICAgICAgIG9uQW5pbWF0aW9uQ29tcGxldGVkKHNldHRpbmdzLCB3aWR0aCwgaGVpZ2h0KTsNCiogICAgICAgICB9KTsNCiogICAgIH07DQoqDQoqICAgICAvL2FkZGluZyBuZXcgZWZmZWN0IHRvIFhBLmNvbXBvbmVudC5jYXJvdXNlbHMuVHJhbnNpdGlvbnMgbW9kdWxlLg0KKiAgICAgWEEuY29tcG9uZW50LmNhcm91c2Vscy5UcmFuc2l0aW9ucy5TYW1wbGVUcmFuc2l0aW9uID0gU2FtcGxlVHJhbnNpdGlvbjsNCiogfSAoKSk7DQogKg0KICovDQpYQS5jb21wb25lbnQuY2Fyb3VzZWxzLlRyYW5zaXRpb25zID0gKGZ1bmN0aW9uKCQpIHsNCiAgICB2YXIgcHViID0ge307DQoNCiAgICAvKioNCiAgICAgKiBUcmFuc2l0aW9uU2V0dGluZ3MgY2xhc3MgaG9sZHMgZGF0YSBuZWVkZWQgZm9yIGNoYW5naW5nIHNsaWRlcw0KICAgICAqIEBjb25zdHJ1Y3Rvcg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIFRyYW5zaXRpb25TZXR0aW5ncygpIHt9DQogICAgLyoqDQogICAgICogQ3VycmVudCBzbGlkZSAoY3VycmVudGx5IGRpc3BsYXllZCkgalF1ZXJ5IG9iamVjdA0KICAgICAqDQogICAgICogQG1lbWJlciBUcmFuc2l0aW9uU2V0dGluZ3MNCiAgICAgKi8NCiAgICBUcmFuc2l0aW9uU2V0dGluZ3MucHJvdG90eXBlLiRjdXJyZW50U2xpZGUgPSBudWxsOw0KICAgIC8qKg0KICAgICAqIE5leHQgc2xpZGUgalF1ZXJ5IG9iamVjdA0KICAgICAqDQogICAgICogQG1lbWJlciBUcmFuc2l0aW9uU2V0dGluZ3MNCiAgICAgKi8NCiAgICBUcmFuc2l0aW9uU2V0dGluZ3MucHJvdG90eXBlLiRuZXh0U2xpZGUgPSBudWxsOw0KICAgIC8qKg0KICAgICAqIEFsbCBzbGlkZXMgKGpRdWVyeSBvYmplY3QpDQogICAgICoNCiAgICAgKiBAbWVtYmVyIFRyYW5zaXRpb25TZXR0aW5ncw0KICAgICAqLw0KICAgIFRyYW5zaXRpb25TZXR0aW5ncy5wcm90b3R5cGUuJHNsaWRlcyA9IG51bGw7DQogICAgLyoqDQogICAgICogT2Zmc2V0IGJldHdlZW4gJGN1cnJlbnRTbGlkZSBhbmQgJG5leHRTbGlkZQ0KICAgICAqDQogICAgICogQG1lbWJlciBUcmFuc2l0aW9uU2V0dGluZ3MNCiAgICAgKi8NCiAgICBUcmFuc2l0aW9uU2V0dGluZ3MucHJvdG90eXBlLm9mZnNldCA9IDA7DQogICAgLyoqDQogICAgICogQ2FsbGJhY2sgZnVuY3Rpb24gd2hpY2ggbXVzdCBiZSBjYWxsZWQgYWZ0ZXIgYW5pbWF0aW9uLg0KICAgICAqDQogICAgICogQG1lbWJlciBUcmFuc2l0aW9uU2V0dGluZ3MNCiAgICAgKi8NCiAgICBUcmFuc2l0aW9uU2V0dGluZ3MucHJvdG90eXBlLmNhbGxiYWNrID0gbnVsbDsNCiAgICAvKioNCiAgICAgKiBlbmQgb2YgVHJhbnNpdGlvblNldHRpbmdzIGNsYXNzDQogICAgICovDQogICAgcHViLlRyYW5zaXRpb25TZXR0aW5ncyA9IFRyYW5zaXRpb25TZXR0aW5nczsNCg0KICAgIC8qKg0KICAgICAqIFRyYW5zaXRpb24gY2xhc3MgaXMgYSBiYXNlIGNsYXNzIG9mIGFsbCB0cmFuc2l0aW9ucy4NCiAgICAgKg0KICAgICAqIEltcG9ydGFudDogc2V0dGluZ3MuY2FsbGJhY2soKSAoQHNlZSBUcmFuc2l0aW9uU2V0dGluZ3MpIGhhdmUgdG8gYmUgY2FsbGVkIGF0IHRoZSBlbmQgb2YgZXhlY3V0aW9uIHRoZSBwZXJmb3JtKCkgbWV0aG9kLg0KICAgICAqDQogICAgICogQGNvbnN0cnVjdG9yDQogICAgICovDQogICAgZnVuY3Rpb24gVHJhbnNpdGlvbigpIHt9DQogICAgVHJhbnNpdGlvbi5wcm90b3R5cGUgPSBuZXcgVHJhbnNpdGlvbigpOw0KICAgIC8qKg0KICAgICAqIEluaXRpYWxpemVzIGEgdHJhbnNpdGlvbiB3aXRoIGdpdmVuIHNldHRpbmdzIChAc2VlIFRyYW5zaXRpb25TZXR0aW5ncykuDQogICAgICoNCiAgICAgKiBAbWVtYmVyIFRyYW5zaXRpb24NCiAgICAgKiBAcGFyYW0ge1RyYW5zaXRpb25TZXR0aW5nc30gc2V0dGluZ3MgIHRyYW5zaXRpb24gc2V0dGluZ3MNCiAgICAgKi8NCiAgICBUcmFuc2l0aW9uLnByb3RvdHlwZS5pbml0ID0gZnVuY3Rpb24oc2V0dGluZ3MpIHt9Ow0KICAgIC8qKg0KICAgICAqIFJldHVybnMgYSBmYWN0b3IgYXNzb2NpYXRlZCB3aXRoIHNldHRpbmdzLm9mZnNldCAoQHNlZSBUcmFuc2l0aW9uU2V0dGluZ3MpLCB3aGljaA0KICAgICAqIGNhbiBiZSB1c2VmdWxsIGZvciBzb21lIGFuaW1hdGlvbnMuDQogICAgICoNCiAgICAgKiBAbWVtYmVyIFRyYW5zaXRpb24NCiAgICAgKiBAcGFyYW0ge1RyYW5zaXRpb25TZXR0aW5nc30gc2V0dGluZ3MgIHRyYW5zaXRpb24gc2V0dGluZ3MNCiAgICAgKiBAcmV0dXJuIFRoZSBmYWN0b3I7IDEgaWYgb2Zmc2V0IGlzIGhpZ2hlciB0aGFuIDAsIC0xIG90aGVyd2lzZQ0KICAgICAqIEB0eXBlIE51bWJlcg0KICAgICAqLw0KICAgIFRyYW5zaXRpb24ucHJvdG90eXBlLmZhY3RvciA9IGZ1bmN0aW9uKHNldHRpbmdzKSB7DQogICAgICAgIHJldHVybiAoc2V0dGluZ3Mub2Zmc2V0ID4gMCkgPyAxIDogLTE7DQogICAgfTsNCiAgICAvKioNCiAgICAgKiBUaGlzIG1ldGhvZCBpcyBjYWxsZWQgdXNlZCBieSBjYXJvdXNlbHMgdG8gY2hhbmdlIHNsaWRlcy4NCiAgICAgKg0KICAgICAqIEltcG9ydGFudDogc2V0dGluZ3MuY2FsbGJhY2soKSAoQHNlZSBUcmFuc2l0aW9uU2V0dGluZ3MpIGhhdmUgdG8gYmUgY2FsbGVkIGF0IHRoZSBlbmQgb2YgdGhpcyBtZXRob2QgZXhlY3V0aW9uLg0KICAgICAqDQogICAgICogQG1lbWJlciBUcmFuc2l0aW9uDQogICAgICogQHBhcmFtIHtUcmFuc2l0aW9uU2V0dGluZ3N9IHNldHRpbmdzICB0cmFuc2l0aW9uIHNldHRpbmdzDQogICAgICovDQogICAgVHJhbnNpdGlvbi5wcm90b3R5cGUucGVyZm9ybSA9IGZ1bmN0aW9uKHNldHRpbmdzKSB7DQogICAgICAgIHNldHRpbmdzLmNhbGxiYWNrKCk7DQogICAgfTsNCiAgICAvKioNCiAgICAgKiBFbmQgb2YgVHJhbnNpdGlvbiBjbGFzcw0KICAgICAqLw0KICAgIHB1Yi5UcmFuc2l0aW9uID0gVHJhbnNpdGlvbjsNCg0KICAgIC8qKg0KICAgICAqIEJhc2ljVHJhbnNpdGlvbiBjbGFzcyBjaGFuZ2VzIHNsaWRlcyB3aXRob3V0IGFueSBhbmltYXRpb24uDQogICAgICogRG8gbm90IHJlbW92ZSB0aGlzIGNsYXNzLCBiZWNhb3VzZSBjYXJvdXNlbHMgd2lsbCB1c2UgaXQgYnkgZGVmYXVsdCwNCiAgICAgKiBpZiByZXF1ZXN0ZWQgdHJhbnNpdGlvbiBjYW5ub3QgYmUgZm91bmQuDQogICAgICogQGNvbnN0cnVjdG9yDQogICAgICovDQogICAgZnVuY3Rpb24gQmFzaWNUcmFuc2l0aW9uKCkge30NCiAgICBCYXNpY1RyYW5zaXRpb24ucHJvdG90eXBlID0gbmV3IFRyYW5zaXRpb24oKTsNCiAgICBCYXNpY1RyYW5zaXRpb24uY29uc3RydWN0b3IgPSBCYXNpY1RyYW5zaXRpb247DQogICAgLyoqDQogICAgICogQG1lbWJlciBCYXNpY1RyYW5zaXRpb24NCiAgICAgKi8NCiAgICBCYXNpY1RyYW5zaXRpb24ucHJvdG90eXBlLnBlcmZvcm0gPSBmdW5jdGlvbihzZXR0aW5ncykgew0KICAgICAgICBzZXR0aW5ncy4kY3VycmVudFNsaWRlLmhpZGUoKTsNCiAgICAgICAgc2V0dGluZ3MuJG5leHRTbGlkZS5zaG93KCk7DQoNCiAgICAgICAgc2V0dGluZ3MuY2FsbGJhY2soKTsNCiAgICB9Ow0KICAgIC8qKg0KICAgICAqIEVuZCBvZiBCYXNpY1RyYW5zaXRpb24gY2xhc3MNCiAgICAgKi8NCiAgICBwdWIuQmFzaWNUcmFuc2l0aW9uID0gQmFzaWNUcmFuc2l0aW9uOw0KDQogICAgLyoqDQogICAgICogRmFkZUluVHJhbnNpdGlvbiBjbGFzcyBjaGFuZ2VzIHNsaWRlcyBieSBmYWRpbmcgaW4gbmV3IHNsaWRlLg0KICAgICAqIFRoaXMgY2xhc3MgY2FuIGJlIHJlbW92ZWQgaWYgZWZmZWN0IGlzIG5vdCB1c2VkLg0KICAgICAqIEBjb25zdHJ1Y3Rvcg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIEZhZGVJblRyYW5zaXRpb24oKSB7fQ0KICAgIEZhZGVJblRyYW5zaXRpb24ucHJvdG90eXBlID0gbmV3IFRyYW5zaXRpb24oKTsNCiAgICBGYWRlSW5UcmFuc2l0aW9uLmNvbnN0cnVjdG9yID0gRmFkZUluVHJhbnNpdGlvbjsNCiAgICAvKioNCiAgICAgKiBAbWVtYmVyIEZhZGVJblRyYW5zaXRpb24NCiAgICAgKi8NCiAgICBGYWRlSW5UcmFuc2l0aW9uLnByb3RvdHlwZS5pbml0ID0gZnVuY3Rpb24oc2V0dGluZ3MpIHsNCiAgICAgICAgLypzZXR0aW5ncy4kc2xpZGVzLmNzcyh7DQogICAgICAgICAncG9zaXRpb24nOiAnYWJzb2x1dGUnLA0KICAgICAgICAgJ3RvcCc6ICcwcHgnLA0KICAgICAgICAgJ2xlZnQnOiAnMHB4Jw0KICAgICAgICAgfSk7Ki8NCiAgICB9Ow0KICAgIC8qKg0KICAgICAqIEBtZW1iZXIgRmFkZUluVHJhbnNpdGlvbg0KICAgICAqLw0KICAgIEZhZGVJblRyYW5zaXRpb24ucHJvdG90eXBlLnBlcmZvcm0gPSBmdW5jdGlvbihzZXR0aW5ncykgew0KICAgICAgICB2YXIgekluZGV4QXR0cmliID0gJ3otaW5kZXgnLA0KICAgICAgICAgICAgJHBhcmVudCA9IHNldHRpbmdzLiRzbGlkZXMucGFyZW50KCksDQogICAgICAgICAgICAkbmV4dFNsaWRlID0gc2V0dGluZ3MuJG5leHRTbGlkZTsNCg0KICAgICAgICAkcGFyZW50LmNzcyh6SW5kZXhBdHRyaWIsIDApOw0KICAgICAgICAkbmV4dFNsaWRlLmNzcyh6SW5kZXhBdHRyaWIsIDEpOw0KICAgICAgICBzZXR0aW5ncy4kc2xpZGVzLmNzcyh7DQogICAgICAgICAgICAncG9zaXRpb24nOiAncmVsYXRpdmUnDQogICAgICAgIH0pOw0KDQogICAgICAgIHNldHRpbmdzLiRuZXh0U2xpZGUuY3NzKHsNCiAgICAgICAgICAgICdwb3NpdGlvbic6ICdhYnNvbHV0ZScsDQogICAgICAgICAgICAndG9wJzogJzBweCcsDQogICAgICAgICAgICAnbGVmdCc6ICcwcHgnDQogICAgICAgIH0pOw0KDQoNCiAgICAgICAgJG5leHRTbGlkZS5mYWRlSW4oZnVuY3Rpb24oKSB7DQogICAgICAgICAgICBzZXR0aW5ncy4kY3VycmVudFNsaWRlLmhpZGUoKTsNCg0KICAgICAgICAgICAgc2V0dGluZ3MuJG5leHRTbGlkZS5jc3Moew0KICAgICAgICAgICAgICAgICdwb3NpdGlvbic6ICdyZWxhdGl2ZScNCiAgICAgICAgICAgIH0pOw0KDQogICAgICAgICAgICAkbmV4dFNsaWRlLmNzcyh6SW5kZXhBdHRyaWIsICcnKTsNCiAgICAgICAgICAgICRwYXJlbnQuY3NzKHpJbmRleEF0dHJpYiwgJycpOw0KDQogICAgICAgICAgICBzZXR0aW5ncy5jYWxsYmFjaygpOw0KICAgICAgICB9KTsNCiAgICB9Ow0KICAgIC8qKg0KICAgICAqIEVuZCBvZiBGYWRlSW5UcmFuc2l0aW9uIGNsYXNzDQogICAgICovDQogICAgcHViLkZhZGVJblRyYW5zaXRpb24gPSBGYWRlSW5UcmFuc2l0aW9uOw0KDQogICAgLyoqDQogICAgICogU2xpZGVIb3Jpem9udGFsbHlUcmFuc2l0aW9uIGNsYXNzIGNoYW5nZXMgc2xpZGVzIGJ5IHNsaWRpbmcgdGhlbSBob3Jpem9udGFsbHkuDQogICAgICogVGhpcyBjbGFzcyBjYW4gYmUgcmVtb3ZlZCBpZiBlZmZlY3QgaXMgbm90IHVzZWQuDQogICAgICogSWYgb2Zmc2V0IChkaWZmZXJlbmNlIGJldHdlZW4gaW5kZXggb2YgY3VycmVudGx5IGRpc3BsYXllZCBzbGlkZSBhbmQgaW5kZXggb2Ygc2xpZGUgdGhhdCB3aWxsIGJlIHNob3duKQ0KICAgICAqIGlzIGdyZWF0ZXIgdGhhbiAwLCBzbGlkZXMgYXJlIHNsaWRpbmcgdG8gdGhlIGxlZnQuIE90aGVyd2lzZSAob2Zmc2V0IGlzIGxvd2VyIHRoYW4gMCksIHNsaWRlcyBhcmUgc2xpZGluZw0KICAgICAqIHRvIHRoZSBsZWZ0Lg0KICAgICAqIFdoZW4gc2xpZGUgY2hhbmdlIGlzIHJhaXNlZCBhdXRvbWF0aWNhbGx5LCBzbGlkZXMgYXJlIGFsd2F5cyBzbGlkaW5nIHRvIHJpZ2h0IChvZmZzZXQgPT0gMSkuDQogICAgICogSWYgdXNlciByYWlzZXMgc2xpZGVzIGNoYW5nZSwgc2xpZGVzIGFyZSBzbGlkaW5nOg0KICAgICAqIC0gdG8gbGVmdCwgaWYgb2Zmc2V0IGlzIGdyZWF0ZXIgdGhhbiAwIChzbGlkZSB3aXRoIGhpZ2hlciBpbmRleCB3aWxsIGJlIHNob3duIG9yIHVzZXIgY2xpY2tzIG9uICduZXh0JyBuYXZpZ2F0aW9uIGl0ZW0pLA0KICAgICAqIC0gdG8gcmlnaHQsIGlmIG9mZnNldCBpcyBsb3dlciB0aGFuIDAgKHNsaWRlIHdpdGggbG93ZXIgaW5kZXggd2lsbCBiZSBzaG93biBvciB1c2VyIGNsaWNrcyBvbiAncHJldicgbmF2aWdhdGlvbiBpdGVtKS4NCiAgICAgKiBAY29uc3RydWN0b3INCiAgICAgKi8NCiAgICBmdW5jdGlvbiBTbGlkZUhvcml6b250YWxseVRyYW5zaXRpb24oKSB7fQ0KICAgIFNsaWRlSG9yaXpvbnRhbGx5VHJhbnNpdGlvbi5wcm90b3R5cGUgPSBuZXcgVHJhbnNpdGlvbigpOw0KICAgIFNsaWRlSG9yaXpvbnRhbGx5VHJhbnNpdGlvbi5jb25zdHJ1Y3RvciA9IFNsaWRlSG9yaXpvbnRhbGx5VHJhbnNpdGlvbjsNCiAgICAvKioNCiAgICAgKiBAbWVtYmVyIFNsaWRlSG9yaXpvbnRhbGx5VHJhbnNpdGlvbg0KICAgICAqLw0KICAgIFNsaWRlSG9yaXpvbnRhbGx5VHJhbnNpdGlvbi5wcm90b3R5cGUub25BbmltYXRpb25Db21wbGV0ZSA9IGZ1bmN0aW9uKHNldHRpbmdzLCAkcGFyZW50KSB7DQogICAgICAgIHNldHRpbmdzLiRjdXJyZW50U2xpZGUuaGlkZSgpOw0KICAgICAgICBzZXR0aW5ncy4kbmV4dFNsaWRlLmNzcyh7DQogICAgICAgICAgICAncG9zaXRpb24nOiAnJywNCiAgICAgICAgICAgICd0b3AnOiAnJywNCiAgICAgICAgICAgICdsZWZ0JzogJycNCiAgICAgICAgfSk7DQoNCiAgICAgICAgJHBhcmVudC5jc3MoJ21hcmdpbi1sZWZ0JywgJycpOw0KDQogICAgICAgIHNldHRpbmdzLmNhbGxiYWNrKCk7DQogICAgfTsNCiAgICAvKioNCiAgICAgKiBAbWVtYmVyIFNsaWRlSG9yaXpvbnRhbGx5VHJhbnNpdGlvbg0KICAgICAqLw0KICAgIFNsaWRlSG9yaXpvbnRhbGx5VHJhbnNpdGlvbi5wcm90b3R5cGUucGVyZm9ybSA9IGZ1bmN0aW9uKHNldHRpbmdzKSB7DQogICAgICAgIHZhciBmYWN0b3IgPSB0aGlzLmZhY3RvcihzZXR0aW5ncyksDQogICAgICAgICAgICBvbkFuaW1hdGlvbkNvbXBsZXRlID0gdGhpcy5vbkFuaW1hdGlvbkNvbXBsZXRlLA0KICAgICAgICAgICAgd2lkdGggPSBzZXR0aW5ncy4kY3VycmVudFNsaWRlLndpZHRoKCksDQogICAgICAgICAgICAkcGFyZW50ID0gc2V0dGluZ3MuJHNsaWRlcy5wYXJlbnQoKTsNCg0KICAgICAgICBzZXR0aW5ncy4kbmV4dFNsaWRlLmNzcyh7DQogICAgICAgICAgICAncG9zaXRpb24nOiAnYWJzb2x1dGUnLA0KICAgICAgICAgICAgJ3RvcCc6ICcwcHgnLA0KICAgICAgICAgICAgJ2xlZnQnOiBmYWN0b3IgKiB3aWR0aA0KICAgICAgICB9KTsNCiAgICAgICAgc2V0dGluZ3MuJG5leHRTbGlkZS5zaG93KCk7DQoNCiAgICAgICAgJHBhcmVudC5hbmltYXRlKHsNCiAgICAgICAgICAgICdtYXJnaW4tbGVmdCc6IC1mYWN0b3IgKiB3aWR0aA0KICAgICAgICB9LCBmdW5jdGlvbigpIHsNCiAgICAgICAgICAgIG9uQW5pbWF0aW9uQ29tcGxldGUoc2V0dGluZ3MsICRwYXJlbnQpOw0KICAgICAgICB9KTsNCiAgICB9Ow0KICAgIC8qKg0KICAgICAqIEVuZCBvZiBTbGlkZUhvcml6b250YWxseVRyYW5zaXRpb24gY2xhc3MNCiAgICAgKi8NCiAgICBwdWIuU2xpZGVIb3Jpem9udGFsbHlUcmFuc2l0aW9uID0gU2xpZGVIb3Jpem9udGFsbHlUcmFuc2l0aW9uOw0KDQogICAgLyoqDQogICAgICogU2xpZGVWZXJ0aWNhbGx5VHJhbnNpdGlvbiBjbGFzcyBjaGFuZ2VzIHNsaWRlcyBieSBzbGlkaW5nIHRoZW0gdmVydGljYWxseS4NCiAgICAgKiBUaGlzIGNsYXNzIGNhbiBiZSByZW1vdmVkIGlmIHRoaXMgZWZmZWN0IGlzIG5vdCB1c2VkLg0KICAgICAqIElmIG9mZnNldCAoZGlmZmVyZW5jZSBiZXR3ZWVuIGluZGV4IG9mIGN1cnJlbnRseSBkaXNwbGF5ZWQgc2xpZGUgYW5kIGluZGV4IG9mIHNsaWRlIHRoYXQgd2lsbCBiZSBzaG93bikNCiAgICAgKiBpcyBncmVhdGVyIHRoYW4gMCwgc2xpZGVzIGFyZSBzbGlkaW5nIGZyb20gdXAgdG8gZG93bi4gT3RoZXJ3aXNlIChvZmZzZXQgaXMgbG93ZXIgdGhhbiAwKSwgc2xpZGVzIGFyZSBzbGlkaW5nDQogICAgICogZnJvbSBkb3duIHRvIHVwLg0KICAgICAqIFdoZW4gc2xpZGUgY2hhbmdlIGlzIHJhaXNlZCBhdXRvbWF0aWNhbGx5LCBzbGlkZXMgYXJlIGFsd2F5cyBzbGlkaW5nIGZyb20gdXAgdG8gZG93biAob2Zmc2V0ID09IDEpLg0KICAgICAqIElmIHVzZXIgcmFpc2VzIHNsaWRlcyBjaGFuZ2UsIHNsaWRlcyBhcmUgc2xpZGluZzoNCiAgICAgKiAtIGZyb20gdXAgdG8gZG93biwgaWYgb2Zmc2V0IGlzIGdyZWF0ZXIgdGhhbiAwIChzbGlkZSB3aXRoIGhpZ2hlciBpbmRleCB3aWxsIGJlIHNob3duIG9yIHVzZXIgY2xpY2tzIG9uICduZXh0JyBuYXZpZ2F0aW9uIGl0ZW0pLA0KICAgICAqIC0gZnJvbSBkb3duIHRvIHVwLCBpZiBvZmZzZXQgaXMgbG93ZXIgdGhhbiAwIChzbGlkZSB3aXRoIGxvd2VyIGluZGV4IHdpbGwgYmUgc2hvd24gb3IgdXNlciBjbGlja3Mgb24gJ3ByZXYnIG5hdmlnYXRpb24gaXRlbSkuDQogICAgICogQGNvbnN0cnVjdG9yDQogICAgICovDQogICAgZnVuY3Rpb24gU2xpZGVWZXJ0aWNhbGx5VHJhbnNpdGlvbigpIHt9DQogICAgU2xpZGVWZXJ0aWNhbGx5VHJhbnNpdGlvbi5wcm90b3R5cGUgPSBuZXcgVHJhbnNpdGlvbigpOw0KICAgIFNsaWRlVmVydGljYWxseVRyYW5zaXRpb24uY29uc3RydWN0b3IgPSBTbGlkZVZlcnRpY2FsbHlUcmFuc2l0aW9uOw0KICAgIC8qKg0KICAgICAqIEBtZW1iZXIgU2xpZGVWZXJ0aWNhbGx5VHJhbnNpdGlvbg0KICAgICAqLw0KICAgIFNsaWRlVmVydGljYWxseVRyYW5zaXRpb24ucHJvdG90eXBlLm9uQW5pbWF0aW9uQ29tcGxldGUgPSBmdW5jdGlvbihzZXR0aW5ncywgJHBhcmVudCkgew0KICAgICAgICBzZXR0aW5ncy4kY3VycmVudFNsaWRlLmhpZGUoKTsNCiAgICAgICAgc2V0dGluZ3MuJG5leHRTbGlkZS5jc3Moew0KICAgICAgICAgICAgJ3Bvc2l0aW9uJzogJycsDQogICAgICAgICAgICAndG9wJzogJycsDQogICAgICAgICAgICAnbGVmdCc6ICcnDQogICAgICAgIH0pOw0KDQogICAgICAgICRwYXJlbnQuY3NzKCdtYXJnaW4tdG9wJywgJycpOw0KDQogICAgICAgIHNldHRpbmdzLmNhbGxiYWNrKCk7DQogICAgfTsNCiAgICAvKioNCiAgICAgKiBAbWVtYmVyIFNsaWRlVmVydGljYWxseVRyYW5zaXRpb24NCiAgICAgKi8NCiAgICBTbGlkZVZlcnRpY2FsbHlUcmFuc2l0aW9uLnByb3RvdHlwZS5wZXJmb3JtID0gZnVuY3Rpb24oc2V0dGluZ3MpIHsNCiAgICAgICAgdmFyIGZhY3RvciA9IHRoaXMuZmFjdG9yKHNldHRpbmdzKSwNCiAgICAgICAgICAgIG9uQW5pbWF0aW9uQ29tcGxldGUgPSB0aGlzLm9uQW5pbWF0aW9uQ29tcGxldGUsDQogICAgICAgICAgICBoZWlnaHQgPSBzZXR0aW5ncy4kY3VycmVudFNsaWRlLmhlaWdodCgpLA0KICAgICAgICAgICAgJHBhcmVudCA9IHNldHRpbmdzLiRzbGlkZXMucGFyZW50KCk7DQoNCiAgICAgICAgc2V0dGluZ3MuJG5leHRTbGlkZS5jc3Moew0KICAgICAgICAgICAgJ3Bvc2l0aW9uJzogJ2Fic29sdXRlJywNCiAgICAgICAgICAgICd0b3AnOiAtZmFjdG9yICogaGVpZ2h0LA0KICAgICAgICAgICAgJ2xlZnQnOiAnMHB4Jw0KICAgICAgICB9KTsNCiAgICAgICAgc2V0dGluZ3MuJG5leHRTbGlkZS5zaG93KCk7DQoNCiAgICAgICAgJHBhcmVudC5hbmltYXRlKHsNCiAgICAgICAgICAgICdtYXJnaW4tdG9wJzogZmFjdG9yICogaGVpZ2h0DQogICAgICAgIH0sIGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgb25BbmltYXRpb25Db21wbGV0ZShzZXR0aW5ncywgJHBhcmVudCk7DQogICAgICAgIH0pOw0KICAgIH07DQogICAgLyoqDQogICAgICogU2xpZGVWZXJ0aWNhbGx5VHJhbnNpdGlvbiBjbGFzcw0KICAgICAqLw0KICAgIHB1Yi5TbGlkZVZlcnRpY2FsbHlUcmFuc2l0aW9uID0gU2xpZGVWZXJ0aWNhbGx5VHJhbnNpdGlvbjsNCg0KICAgIHJldHVybiBwdWI7DQp9KGpRdWVyeSkpOw0KLyoqDQogKiBlbmQgb2YgWEEuY29tcG9uZW50LmNhcm91c2Vscy5UcmFuc2l0aW9ucyBtb2R1bGUuDQogKi8NCg0KLyoqDQogKiBDb2duaWZpZGUNCiAqDQogKiBYQS5jb21wb25lbnQuY2Fyb3VzZWxzLkluZGljYXRvclZpZXdzIG1vZHVsZS4NCiAqDQogKiBFeHBvc2VzIFZpZXcgY2xhc3MsIHdoaWNoIGlzIGEgYmFzZSBjbGFzcyBvZiBhbGwgJ3RpbWUgaW5kaWNhdG9yJyB2aWV3cyB1c2VkIGJ5IGNhcm91c2VscyAoQHNlZSBYQS5jb21wb25lbnQuY2Fyb3VzZWxzLCBAc2VlIFZpZXcpLg0KICogQWxzbyBleHBvc2VzIGltcGxlbWVudGF0aW9uIG9mIHRoZXNlICd0aW1lIGluZGljYXRvcicgdmlld3M6DQogKiAtIFByb2dyZXNzQmFyVmlldyAtIHNob3dzIHRoZSBwcm9ncmVzcyBvZiB0aW1lLCB0aGF0IGxvb2tzIGxpa2UgYSBwcm9ncmVzcyBiYXIsDQogKiAtIFJvdGF0b3JWaWV3IC0gc2hvd3MgdGhlIHByb2dyZXNzIG9mIHRpbWUgd2l0aCB0aGUgZmlsbGluZyB1cCByaW5nLg0KICogQ2Fyb3VzZWwgdGFrZXMgdGhlIGNsYXNzIGNvbnN0cnVjdG9yIGJ5IG5hbWUgZnJvbSB0aGlzIG1vZHVsZSAoaXQgaXMgZ2l2ZW4gaW4gb3B0aW9ucyBvYmplY3Qgb2YgY2Fyb3VzZWw7IEBzZWUgWEEuY29tcG9uZW50LmNhcm91c2VscykuDQogKiBJZiB0aGVyZSBpcyBhIG5lZWQgdG8gaW1wbGVtZW50IHRoZSBuZXcgJ3RpbWUgaW5kaWNhdG9yJyB2aWV3LCBjcmVhdGUgYSBuZXcgY2xhc3MsDQogKiBieSBpbmhlcml0aW5nIGZyb20gVmlldyBjbGFzcyBhbmQgYWRkIGl0IHRvIHRoaXMgbW9kdWxlLiBEdXJpbmcgaW1wbGVtZW50YXRpb24gb2YgYSBuZXcgJ3RpbWUgaW5kaWNhdG9yJw0KICogdmlldyB0aGUgWEEuY29tcG9uZW50LmNhcm91c2Vscy5JbmRpY2F0b3JzVmlldy5Ub29scyBuYW1lc3BhY2UgbWF5IGJlIHVzZWZ1bGwuIEl0IGNvbnRhaW5zOg0KICogLSBpc0Nzc1N1cHBvcnRlZChwcm9wcykgZnVuY3Rpb24sIHdoaWNoIGNoZWNrcyBpZiBhbnkgb2YgQ1NTIHByb3BlcnRpZXMgaXMgc3VwcG9ydGVkIChwcm9wcyAtIGFycmF5IG9mIHByb3BlcnRpZXMpLA0KICogLSBpc1RyYW5zZm9ybVN1cHBvcnRlZCgpIGZ1bmN0aW9uLCB3aGljaCBjaGVja3MgaWYgQ1NTIDMgJ3RyYW5zZm9ybScgaXMgc3VwcG9ydGVkLg0KICoNCiAqIEV4YW1wbGUgdmlldyBpbXBsZW1lbnRhdGlvbiAob3BhY2l0eSBpbmNyZWFzZXMgd2l0aCBhIHByb2dyZXNzIG9mIHRoZSB0aW1lKToNCiAqIChmdW5jdGlvbigpIHsNCiAqICAgICB2YXIgVmlldyA9IFhBLmNvbXBvbmVudC5jYXJvdXNlbHMuSW5kaWNhdG9yVmlld3MuVmlldzsNCiAqDQogKiAgICAgZnVuY3Rpb24gU2FtcGxlVmlldyAoc2VsZWN0b3IsIG9wdGlvbnMpIHsNCiAqICAgICAgICAgLy9iYXNlIGNvbnN0cnVjdG9yIGhhdmUgdG8gYmUgY2FsbGVkDQogKiAgICAgICAgIFZpZXcuY2FsbCh0aGlzLCBzZWxlY3Rvcik7DQogKiAgICAgfQ0KICoNCiAqICAgICBTYW1wbGVWaWV3LnByb3RvdHlwZSA9IG5ldyBWaWV3KCk7DQogKiAgICAgU2FtcGxlVmlldy5jb25zdHJ1Y3RvciA9IFNhbXBsZVZpZXc7DQogKg0KICogICAgIFNhbXBsZVZpZXcucHJvdG90eXBlLmluaXQgPSBmdW5jdGlvbiAodGltZW91dCkgew0KICogICAgICAgICAvL2Jhc2UgbWV0aG9kIGhhdmUgdG8gYmUgY2FsbGVkDQogKiAgICAgICAgIFZpZXcucHJvdG90eXBlLmluaXQuY2FsbCh0aGlzLCB0aW1lb3V0KTsNCiAqDQogKiAgICAgICAgIC8vaW5pdGlhbGl6YXRpb24gY29kZSAtIG5vdCBuZWVkZWQgaW4gdGhpcyBleGFtcGxlDQogKiAgICAgfTsNCiAqDQogKiAgICAgU2FtcGxlVmlldy5wcm90b3R5cGUucmVzZXQgPSBmdW5jdGlvbiAoKSB7DQogKiAgICAgICAgIC8vYmFzZSBtZXRob2QgaGF2ZSB0byBiZSBjYWxsZWQNCiAqICAgICAgICAgVmlldy5wcm90b3R5cGUucmVzZXQuY2FsbCh0aGlzKTsNCiAqDQogKiAgICAgICAgIC8vcmVzZXRpbmcgJ3RpbWUgaW5kaWNhdG9yJyB2aWV3DQogKiAgICAgICAgIHRoaXMuJGluZGljYXRvci5zdG9wKHRydWUpOw0KICogICAgICAgICB0aGlzLiRpbmRpY2F0b3IuY3NzKCdvcGFjaXR5JywgMCk7DQogKiAgICAgfTsNCiAqDQogKiAgICAgU2FtcGxlVmlldy5wcm90b3R5cGUucGF1c2UgPSBmdW5jdGlvbiAoKSB7DQogKiAgICAgICAgIC8vc3RvcGluZyAndGltZSBpbmRpY2F0b3InIHZpZXcgYW5pbWF0aW9uDQogKiAgICAgICAgIHRoaXMuJGluZGljYXRvci5zdG9wKHRydWUpOw0KICogICAgIH07DQogKg0KICogICAgIFNhbXBsZVZpZXcucHJvdG90eXBlLnBsYXkgPSBmdW5jdGlvbiAoKSB7DQogKiAgICAgICAgIC8vc3RhcnRpbmcvcmVzdW1pbmcgJ3RpbWUgaW5kaWNhdG9yJyB2aWV3IGFuaW1hdGlvbg0KICogICAgICAgICB0aGlzLiRpbmRpY2F0b3IuYW5pbWF0ZSh7DQogKiAgICAgICAgICAgICAnb3BhY2l0eSc6IDENCiAqICAgICAgICAgfSwgdGhpcy50aW1lb3V0IC0gdGhpcy50aW1lRWxhcHNlZCwgJ2xpbmVhcicpOw0KICogICAgIH07DQogKg0KICogICAgIFhBLmNvbXBvbmVudC5jYXJvdXNlbHMuSW5kaWNhdG9yVmlld3MuU2FtcGxlVmlldyA9IFNhbXBsZVZpZXc7DQogKiB9KCkpOw0KICoNCiAqLw0KWEEuY29tcG9uZW50LmNhcm91c2Vscy5JbmRpY2F0b3JWaWV3cyA9IChmdW5jdGlvbigkKSB7DQogICAgdmFyIHB1YiA9IHt9LA0KICAgICAgICBzdXBwb3J0RWxlbWVudFN0eWxlID0gbnVsbDsNCg0KICAgIC8qKg0KICAgICAqIENoZWNrcyBpZiBhbnkgb2YgQ1NTIHByb3BlcnRpZXMgaXMgc3VwcG9ydGVkLg0KICAgICAqDQogICAgICogQHBhcmFtIHtBcnJheX0gcHJvcHMgICAgIGFycmF5IG9mIHByb3BlcnRpZXMgdG8gYmUgY2hlY2tlZA0KICAgICAqIEByZXR1cm4gdHJ1ZSBpZiBhbnkgb2YgQ1NTIHByb3BlcnRpZXMgaXMgc3VwcG9ydGVkLCBmYWxzZSBvdGhlcndpc2UNCiAgICAgKiBAdHlwZSBCb29sZWFuDQogICAgICovDQogICAgZnVuY3Rpb24gaXNDc3NTdXBwb3J0ZWQocHJvcHMpIHsNCiAgICAgICAgdmFyIGksDQogICAgICAgICAgICBpc1N1cHBvcnRlZCA9IGZhbHNlOw0KDQogICAgICAgIGlmIChzdXBwb3J0RWxlbWVudFN0eWxlID09PSBudWxsKSB7DQogICAgICAgICAgICBzdXBwb3J0RWxlbWVudFN0eWxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3VwcG9ydEVsZW1lbnQnKS5zdHlsZTsNCiAgICAgICAgfQ0KDQogICAgICAgIGZvciAoaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgaWYgKHN1cHBvcnRFbGVtZW50U3R5bGVbcHJvcHNbaV1dICE9PSB1bmRlZmluZWQpIHsNCiAgICAgICAgICAgICAgICBpc1N1cHBvcnRlZCA9IHRydWU7DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICByZXR1cm4gaXNTdXBwb3J0ZWQ7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQ2hlY2tzIGlmIENTUyAzICd0cmFuc2Zvcm0nIGlzIHN1cHBvcnRlZC4NCiAgICAgKg0KICAgICAqIEByZXR1cm4gdHJ1ZSBpZiBDU1MgMyAndHJhbnNmb3JtJyBpcyBzdXBwb3J0ZWQsIGZhbHNlIG90aGVyd2lzZQ0KICAgICAqIEB0eXBlIEJvb2xlYW4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiBpc1RyYW5zZm9ybVN1cHBvcnRlZCgpIHsNCiAgICAgICAgcmV0dXJuIGlzQ3NzU3VwcG9ydGVkKFsndHJhbnNmb3JtUHJvcGVydHknLCAnV2Via2l0VHJhbnNmb3JtJywgJ01velRyYW5zZm9ybScsICdPVHJhbnNmb3JtJywgJ21zVHJhbnNmb3JtJ10pOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIFhBLmNvbXBvbmVudC5jYXJvdXNlbHMuSW5kaWNhdG9yVmlld3MuVG9vbHMgbmFtZXNwYWNlDQogICAgICoNCiAgICAgVGhpcyBuYW1lc3BhY2UgY2FuIGJlIHJlbW92ZWQgaWYgUm90YXRvclZpZXcgY2xhc3MgaXMgbm90IHVzZWQgKEBzZWUgUm90YXRvclZpZXcpDQogICAgICovDQogICAgcHViLlRvb2xzID0ge307DQogICAgcHViLlRvb2xzLmlzQ3NzU3VwcG9ydGVkID0gaXNDc3NTdXBwb3J0ZWQ7DQogICAgcHViLlRvb2xzLmlzVHJhbnNmb3JtU3VwcG9ydGVkID0gaXNUcmFuc2Zvcm1TdXBwb3J0ZWQ7DQogICAgLyoqDQogICAgICogRW5kIG9mIG5hbWVzcGFjZQ0KICAgICAqLw0KDQogICAgLyoqDQogICAgICogVmlldyBjbGFzcyBpcyBhIGJhc2UgY2xhc3Mgb2YgYWxsICd0aW1lIGluZGljYXRvcicgdmlld3MNCiAgICAgKiBAY29uc3RydWN0b3INCiAgICAgKiBAcGFyYW0ge1N0cmluZ30gc2VsZWN0b3IgYSBzZWxlY3RvciB1c2VkIGZvciBzZWFyY2hpbmcNCiAgICAgKiBAcGFyYW0ge09iamVjdH0gb3B0aW9ucyAgIFZpZXcgb3B0aW9ucyBvYmplY3QNCiAgICAgKi8NCiAgICBmdW5jdGlvbiBWaWV3KHNlbGVjdG9yLCBvcHRpb25zKSB7DQogICAgICAgIC8qKg0KICAgICAgICAgKiBBIGpRdWVyeSBvYmplY3QgY29udGFpbmluZyBlbGVtZW50LCB3aGljaCB3aWxsIGJlIGFuaW1hdGVkIHRvIHNob3cgcG9ncmVzcyBvZiB0aGUgdGltZS4NCiAgICAgICAgICoNCiAgICAgICAgICogQG1lbWJlciBWaWV3DQogICAgICAgICAqLw0KICAgICAgICB0aGlzLiRpbmRpY2F0b3IgPSAkKHNlbGVjdG9yKTsNCiAgICB9DQogICAgLyoqDQogICAgICogSW5pdGlhbGl6ZXMgdGhlIHZpZXcuDQogICAgICoNCiAgICAgKiBAbWVtYmVyIFZpZXdpb24NCiAgICAgKiBAcGFyYW0ge051bWJlcn0gdGltZW91dCAgIGEgdGltZW91dCB0byB0aGUgZW5kIG9mIHdob2xlIGluZGljYXRvciBhbmltYXRpb24NCiAgICAgKi8NCiAgICBWaWV3LnByb3RvdHlwZS5pbml0ID0gZnVuY3Rpb24odGltZW91dCkgew0KICAgICAgICB0aGlzLnRpbWVFbGFwc2VkID0gMDsNCiAgICAgICAgdGhpcy50aW1lb3V0ID0gdGltZW91dDsNCiAgICB9Ow0KICAgIC8qKg0KICAgICAqIFJlc2V0cyB0aGUgdmlldw0KICAgICAqDQogICAgICogQG1lbWJlciBWaWV3DQogICAgICovDQogICAgVmlldy5wcm90b3R5cGUucmVzZXQgPSBmdW5jdGlvbigpIHsNCiAgICAgICAgdGhpcy50aW1lRWxhcHNlZCA9IDA7DQogICAgfTsNCiAgICAvKioNCiAgICAgKiBTdGFydHMvUmVuZXdzIHRoZSB2aWV3IGFuaW1hdGlvbi4NCiAgICAgKg0KICAgICAqIEBtZW1iZXIgVmlldw0KICAgICAqLw0KICAgIFZpZXcucHJvdG90eXBlLnBsYXkgPSBmdW5jdGlvbigpIHt9Ow0KICAgIC8qKg0KICAgICAqIFBhdXNlcyB0aGUgdmlldyBhbmltYXRpb24uDQogICAgICoNCiAgICAgKiBAbWVtYmVyIFZpZXcNCiAgICAgKi8NCiAgICBWaWV3LnByb3RvdHlwZS5wYXVzZSA9IGZ1bmN0aW9uKCkge307DQogICAgLyoqDQogICAgICogVXBkYXRlcyB0aGUgdGltZSB0aGF0IGVsYXBzZWQgc2luY2UgYW5pbWF0aW9uIGJlZ2luLg0KICAgICAqDQogICAgICogQG1lbWJlciBWaWV3DQogICAgICovDQogICAgVmlldy5wcm90b3R5cGUudXBkYXRlID0gZnVuY3Rpb24odGltZUVsYXBzZWQpIHsNCiAgICAgICAgdGhpcy50aW1lRWxhcHNlZCA9IHRpbWVFbGFwc2VkOw0KICAgIH07DQogICAgLyoqDQogICAgICogZW5kIG9mIFZpZXcgY2xhc3MNCiAgICAgKi8NCiAgICBwdWIuVmlldyA9IFZpZXc7DQoNCiAgICAvKioNCiAgICAgKiBQcm9ncmVzc0JhclZpZXcgY2xhc3MgcHJvdmlkZXMgYSBsb2dpYyBmb3IgYW5pbWF0ZSBhICd0aW1lIGluZGljYXRvcicsDQogICAgICogdGhhdCBsb29rcyBsaWtlIHByb2dyZXNzIGJhci4NCiAgICAgKg0KICAgICAqIE9wdGlvbnMgb2JqZWN0Og0KICAgICAqIHsNCiAgICAgKiAgICAgJ29wYWNpdHknOiBOdW1iZXIgdmFsdWUgLy9iZXR3ZWVuIDAgYW5kIDE7IGRlZmF1bHQgaXMgMC44DQogICAgICogfQ0KICAgICAqDQogICAgICogVGhpcyBjbGFzcyBjYW4gYmUgcmVtb3ZlZCBpZiB0aGlzIGtpbmQgb2YgdmlldyBpcyBub3QgdXNlZC4NCiAgICAgKg0KICAgICAqIEBjb25zdHJ1Y3Rvcg0KICAgICAqIEBwYXJhbSB7U3RyaW5nfSBzZWxlY3RvciBhIHNlbGVjdG9yIHVzZWQgZm9yIHNlYXJjaGluZw0KICAgICAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zICAgVmlldyBvcHRpb25zIG9iamVjdA0KICAgICAqLw0KICAgIGZ1bmN0aW9uIFByb2dyZXNzQmFyVmlldyhzZWxlY3Rvciwgb3B0aW9ucykgew0KICAgICAgICBWaWV3LmNhbGwodGhpcywgc2VsZWN0b3IpOw0KDQogICAgICAgIHZhciBkZWZhdWx0cyA9IHsNCiAgICAgICAgICAgICdvcGFjaXR5JzogMC44DQogICAgICAgIH07DQoNCiAgICAgICAgdGhpcy5zZXR0aW5ncyA9ICQuZXh0ZW5kKHRydWUsIHt9LCBkZWZhdWx0cywgb3B0aW9ucyk7DQoNCiAgICAgICAgdGhpcy4kY29udGFpbmVyID0gdGhpcy4kaW5kaWNhdG9yOw0KICAgICAgICB0aGlzLiRpbmRpY2F0b3IgPSB0aGlzLiRpbmRpY2F0b3IuZmluZCgnZGl2Jyk7DQogICAgfQ0KICAgIFByb2dyZXNzQmFyVmlldy5wcm90b3R5cGUgPSBuZXcgVmlldygpOw0KICAgIFByb2dyZXNzQmFyVmlldy5jb25zdHJ1Y3RvciA9IFByb2dyZXNzQmFyVmlldzsNCiAgICAvKioNCiAgICAgKiBAbWVtYmVyIFByb2dyZXNzQmFyVmlldw0KICAgICAqLw0KICAgIFByb2dyZXNzQmFyVmlldy5wcm90b3R5cGUuaW5pdCA9IGZ1bmN0aW9uKHRpbWVvdXQpIHsNCiAgICAgICAgVmlldy5wcm90b3R5cGUuaW5pdC5jYWxsKHRoaXMsIHRpbWVvdXQpOw0KDQogICAgICAgIHZhciBvcGFjaXR5ID0gdGhpcy5zZXR0aW5ncy5vcGFjaXR5Ow0KICAgICAgICB0aGlzLiRjb250YWluZXIuY3NzKCdvcGFjaXR5Jywgb3BhY2l0eSk7DQogICAgICAgIHRoaXMuJGluZGljYXRvci5jc3MoJ29wYWNpdHknLCBvcGFjaXR5KTsNCiAgICB9Ow0KICAgIC8qKg0KICAgICAqIEBtZW1iZXIgUHJvZ3Jlc3NCYXJWaWV3DQogICAgICovDQogICAgUHJvZ3Jlc3NCYXJWaWV3LnByb3RvdHlwZS5yZXNldCA9IGZ1bmN0aW9uKCkgew0KICAgICAgICBWaWV3LnByb3RvdHlwZS5yZXNldC5jYWxsKHRoaXMpOw0KDQogICAgICAgIHRoaXMuJGluZGljYXRvci5zdG9wKHRydWUpOw0KICAgICAgICB0aGlzLiRpbmRpY2F0b3IuY3NzKCd3aWR0aCcsICcwcHgnKTsNCiAgICB9Ow0KICAgIC8qKg0KICAgICAqIEBtZW1iZXIgUHJvZ3Jlc3NCYXJWaWV3DQogICAgICovDQogICAgUHJvZ3Jlc3NCYXJWaWV3LnByb3RvdHlwZS5wYXVzZSA9IGZ1bmN0aW9uKCkgew0KICAgICAgICB0aGlzLiRpbmRpY2F0b3Iuc3RvcCh0cnVlKTsNCiAgICB9Ow0KICAgIC8qKg0KICAgICAqIEBtZW1iZXIgUHJvZ3Jlc3NCYXJWaWV3DQogICAgICovDQogICAgUHJvZ3Jlc3NCYXJWaWV3LnByb3RvdHlwZS5wbGF5ID0gZnVuY3Rpb24oKSB7DQogICAgICAgIHRoaXMuJGluZGljYXRvci5hbmltYXRlKHsNCiAgICAgICAgICAgICd3aWR0aCc6ICcxMDAlJw0KICAgICAgICB9LCB0aGlzLnRpbWVvdXQgLSB0aGlzLnRpbWVFbGFwc2VkLCAnbGluZWFyJyk7DQogICAgfTsNCiAgICAvKioNCiAgICAgKiBlbmQgb2YgUHJvZ3Jlc3NCYXJWaWV3IGNsYXNzDQogICAgICovDQogICAgcHViLlByb2dyZXNzQmFyVmlldyA9IFByb2dyZXNzQmFyVmlldzsNCg0KICAgIC8qKg0KICAgICAqIFJvdGF0b3JWaWV3IGNsYXNzIHByb3ZpZGVzIGEgbG9naWMgZm9yIGFuaW1hdGUgYSAndGltZSBpbmRpY2F0b3InLA0KICAgICAqIHRoYXQgc2hvd3MgdGhlIHByb2dyZXNzIG9mIHRpbWUgd2l0aCB0aGUgZmlsbGluZyB1cCByaW5nDQogICAgICoNCiAgICAgKiBPcHRpb25zIG9iamVjdDoNCiAgICAgKiB7DQogICAgICogICAgICdvcGFjaXR5JzogTnVtYmVyIHZhbHVlIC8vYmV0d2VlbiAwIGFuZCAxOyBkZWZhdWx0IGlzIDAuNQ0KICAgICAqIH0NCiAgICAgKg0KICAgICAqIFRoaXMgY2xhc3MgY2FuIGJlIHJlbW92ZWQgaWYgdGhpcyBraW5kIG9mIHZpZXcgaXMgbm90IHVzZWQuDQogICAgICoNCiAgICAgKiBAY29uc3RydWN0b3INCiAgICAgKiBAcGFyYW0ge1N0cmluZ30gc2VsZWN0b3IgYSBzZWxlY3RvciB1c2VkIGZvciBzZWFyY2hpbmcNCiAgICAgKiBAcGFyYW0ge09iamVjdH0gb3B0aW9ucyAgIFZpZXcgb3B0aW9ucyBvYmplY3QNCiAgICAgKi8NCiAgICBmdW5jdGlvbiBSb3RhdG9yVmlldyhzZWxlY3Rvciwgb3B0aW9ucykgew0KICAgICAgICBWaWV3LmNhbGwodGhpcywgc2VsZWN0b3IpOw0KDQogICAgICAgIHZhciBkZWZhdWx0cyA9IHsNCiAgICAgICAgICAgICdvcGFjaXR5JzogMC41DQogICAgICAgIH07DQoNCiAgICAgICAgdGhpcy5zZXR0aW5ncyA9ICQuZXh0ZW5kKHRydWUsIHt9LCBkZWZhdWx0cywgb3B0aW9ucyk7DQogICAgICAgIHRoaXMuJG1hc2sgPSB0aGlzLiRpbmRpY2F0b3IuZmluZCgnc3Bhbi5tYXNrJykuZmlyc3QoKTsNCiAgICAgICAgdGhpcy4kcm90YXRvciA9IHRoaXMuJGluZGljYXRvci5maW5kKCdzcGFuLnJvdGF0b3InKS5maXJzdCgpOw0KDQogICAgICAgIGZ1bmN0aW9uIHJvdGF0ZUNzcyhkZWcpIHsNCiAgICAgICAgICAgIHZhciB2YWx1ZSA9ICdyb3RhdGUoJyArIGRlZyArICdkZWcpJzsNCg0KICAgICAgICAgICAgcmV0dXJuIHsNCiAgICAgICAgICAgICAgICAnLXdlYmtpdC10cmFuc2Zvcm0nOiB2YWx1ZSwNCiAgICAgICAgICAgICAgICAnLW1vei10cmFuc2Zvcm0nOiB2YWx1ZSwNCiAgICAgICAgICAgICAgICAnLW8tdHJhbnNmb3JtJzogdmFsdWUsDQogICAgICAgICAgICAgICAgJy1tcy10cmFuc2Zvcm0nOiB2YWx1ZSwNCiAgICAgICAgICAgICAgICAndHJhbnNmb3JtJzogdmFsdWUNCiAgICAgICAgICAgIH07DQogICAgICAgIH0NCg0KICAgICAgICBmdW5jdGlvbiBhbmltYXRlUm90YXRvcigkcm90YXRvciwgb3B0aW9ucykgew0KICAgICAgICAgICAgdmFyIGRlZmF1bHRzID0gew0KICAgICAgICAgICAgICAgICAgICAnZm9udFNpemUnOiAnMTgwcHgnLA0KICAgICAgICAgICAgICAgICAgICAnYW5pbWF0ZU9wdGlvbnMnOiB7DQogICAgICAgICAgICAgICAgICAgICAgICAnc3RlcCc6IGZ1bmN0aW9uKG5vdywgZngpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcm90YXRvci5jc3Mocm90YXRlQ3NzKG5vdykpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICAgICAgICAgICdlYXNpbmcnOiAnbGluZWFyJw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICBzZXR0aW5ncyA9ICQuZXh0ZW5kKHRydWUsIHt9LCBkZWZhdWx0cywgb3B0aW9ucyk7DQoNCiAgICAgICAgICAgICRyb3RhdG9yLmFuaW1hdGUoew0KICAgICAgICAgICAgICAgICAgICAnZm9udC1zaXplJzogc2V0dGluZ3MuZm9udFNpemUNCiAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgIHNldHRpbmdzLmFuaW1hdGVPcHRpb25zKTsNCiAgICAgICAgfQ0KDQogICAgICAgIGZ1bmN0aW9uIHBoYXNlVHdvQW5pbWF0aW9uKCRtYXNrLCAkcm90YXRvciwgZHVyYXRpb24pIHsNCiAgICAgICAgICAgICRyb3RhdG9yLmFkZENsYXNzKCdoYWxmJyk7DQogICAgICAgICAgICAkbWFzay5hZGRDbGFzcygnaGFsZicpOw0KDQogICAgICAgICAgICBhbmltYXRlUm90YXRvcigkcm90YXRvciwgew0KICAgICAgICAgICAgICAgICdmb250U2l6ZSc6ICczNjBweCcsDQogICAgICAgICAgICAgICAgJ2FuaW1hdGVPcHRpb25zJzogew0KICAgICAgICAgICAgICAgICAgICAnZHVyYXRpb24nOiBkdXJhdGlvbg0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9DQoNCiAgICAgICAgZnVuY3Rpb24gcGhhc2VPbmVBbmltYXRpb24oJG1hc2ssICRyb3RhdG9yLCBkdXJhdGlvbiwgcGhhc2VUd29EdXJhdGlvbikgew0KICAgICAgICAgICAgYW5pbWF0ZVJvdGF0b3IoJHJvdGF0b3IsIHsNCiAgICAgICAgICAgICAgICAnYW5pbWF0ZU9wdGlvbnMnOiB7DQogICAgICAgICAgICAgICAgICAgICdkdXJhdGlvbic6IGR1cmF0aW9uLA0KICAgICAgICAgICAgICAgICAgICAnY29tcGxldGUnOiBmdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHBoYXNlVHdvQW5pbWF0aW9uKCRtYXNrLCAkcm90YXRvciwgcGhhc2VUd29EdXJhdGlvbik7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KDQogICAgICAgIHRoaXMucmVzZXRDc3MgPSBmdW5jdGlvbigpIHsNCiAgICAgICAgICAgIHRoaXMuJHJvdGF0b3IucmVtb3ZlQ2xhc3MoJ2hhbGYnKTsNCiAgICAgICAgICAgIHRoaXMuJHJvdGF0b3IuY3NzKHJvdGF0ZUNzcygwKSk7DQogICAgICAgICAgICB0aGlzLiRyb3RhdG9yLmNzcygnZm9udC1zaXplJywgJzBweCcpOw0KDQogICAgICAgICAgICB0aGlzLiRtYXNrLnJlbW92ZUNsYXNzKCdoYWxmJyk7DQogICAgICAgIH07DQoNCiAgICAgICAgdGhpcy5wbGF5UGhhc2VPbmUgPSBmdW5jdGlvbigpIHsNCiAgICAgICAgICAgIHZhciBkdXJhdGlvbiA9IHRoaXMudGltZW91dCAvIDIgLSB0aGlzLnRpbWVFbGFwc2VkOw0KICAgICAgICAgICAgcGhhc2VPbmVBbmltYXRpb24odGhpcy4kbWFzaywgdGhpcy4kcm90YXRvciwgZHVyYXRpb24sIHRoaXMudGltZW91dCAvIDIpOw0KICAgICAgICB9Ow0KDQogICAgICAgIHRoaXMucGxheVBoYXNlVHdvID0gZnVuY3Rpb24oKSB7DQogICAgICAgICAgICB2YXIgZHVyYXRpb24gPSB0aGlzLnRpbWVvdXQgLSB0aGlzLnRpbWVFbGFwc2VkOw0KICAgICAgICAgICAgcGhhc2VUd29BbmltYXRpb24odGhpcy4kbWFzaywgdGhpcy4kcm90YXRvciwgZHVyYXRpb24pOw0KICAgICAgICB9Ow0KICAgIH0NCiAgICBSb3RhdG9yVmlldy5wcm90b3R5cGUgPSBuZXcgVmlldygpOw0KICAgIFJvdGF0b3JWaWV3LmNvbnN0cnVjdG9yID0gUm90YXRvclZpZXc7DQogICAgLyoqDQogICAgICogQG1lbWJlciBSb3RhdG9yVmlldw0KICAgICAqLw0KICAgIFJvdGF0b3JWaWV3LnByb3RvdHlwZS5pbml0ID0gZnVuY3Rpb24odGltZW91dCkgew0KICAgICAgICBWaWV3LnByb3RvdHlwZS5pbml0LmNhbGwodGhpcywgdGltZW91dCk7DQoNCiAgICAgICAgaWYgKGlzVHJhbnNmb3JtU3VwcG9ydGVkKCkpIHsNCiAgICAgICAgICAgIHRoaXMuJGluZGljYXRvci5zaG93KCk7DQogICAgICAgICAgICB0aGlzLiRtYXNrLmNzcygnb3BhY2l0eScsIHRoaXMuc2V0dGluZ3Mub3BhY2l0eSk7DQogICAgICAgIH0NCiAgICB9Ow0KICAgIC8qKg0KICAgICAqIEBtZW1iZXIgUm90YXRvclZpZXcNCiAgICAgKi8NCiAgICBSb3RhdG9yVmlldy5wcm90b3R5cGUucmVzZXQgPSBmdW5jdGlvbigpIHsNCiAgICAgICAgVmlldy5wcm90b3R5cGUucmVzZXQuY2FsbCh0aGlzKTsNCg0KICAgICAgICB0aGlzLiRyb3RhdG9yLnN0b3AodHJ1ZSk7DQogICAgICAgIHRoaXMucmVzZXRDc3MoKTsNCiAgICB9Ow0KICAgIC8qKg0KICAgICAqIEBtZW1iZXIgUm90YXRvclZpZXcNCiAgICAgKi8NCiAgICBSb3RhdG9yVmlldy5wcm90b3R5cGUucGF1c2UgPSBmdW5jdGlvbigpIHsNCiAgICAgICAgdGhpcy4kcm90YXRvci5zdG9wKHRydWUpOw0KICAgIH07DQogICAgLyoqDQogICAgICogQG1lbWJlciBSb3RhdG9yVmlldw0KICAgICAqLw0KICAgIFJvdGF0b3JWaWV3LnByb3RvdHlwZS5wbGF5ID0gZnVuY3Rpb24oKSB7DQogICAgICAgIHZhciBwaGFzZSA9IHRoaXMucGxheVBoYXNlT25lOw0KICAgICAgICBpZiAodGhpcy50aW1lRWxhcHNlZCA+PSB0aGlzLnRpbWVvdXQgLyAyKSB7DQogICAgICAgICAgICBwaGFzZSA9IHRoaXMucGxheVBoYXNlVHdvOw0KICAgICAgICB9DQoNCiAgICAgICAgcGhhc2UuY2FsbCh0aGlzKTsNCiAgICB9Ow0KICAgIC8qKg0KICAgICAqIGVuZCBvZiBSb3RhdG9yVmlldyBjbGFzcw0KICAgICAqLw0KICAgIHB1Yi5Sb3RhdG9yVmlldyA9IFJvdGF0b3JWaWV3Ow0KDQogICAgcmV0dXJuIHB1YjsNCn0oalF1ZXJ5KSk7DQovKioNCiAqIGVuZCBvZiBYQS5jb21wb25lbnQuY2Fyb3VzZWxzLkluZGljYXRvclZpZXdzIG1vZHVsZS4NCiAqLw==
- ID: "6954b7c7-2487-423f-8600-436cb3b6dc0e"
  Hint: Size
  Value: 67936
- ID: "6f47a0a5-9c94-4b48-abeb-42d38def6054"
  Hint: Mime Type
  Value: "application/x-javascript"
- ID: "c06867fe-9a43-4c7d-b739-48780492d06f"
  Hint: Extension
  Value: js
Languages:
- Language: en
  Versions:
  - Version: 1
    Fields:
    - ID: "25bed78c-4957-4165-998a-ca1b52f67497"
      Hint: __Created
      Value: 20170331T161343Z
    - ID: "5dd74568-4d4b-44c1-b513-0af5f4cda34f"
      Hint: __Created by
      Value: sitecore\Admin
